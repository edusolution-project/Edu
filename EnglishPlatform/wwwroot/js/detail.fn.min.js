function chooseFile(n){$(n).siblings("input[type=file]").focus().click()}function changeMedia(n){$(n).uniqueId();$(n).attr("name",$(n).attr("id"));var t=$(n)[0].files[0];$(n).siblings("[for=medianame]").val($(n).attr("id"));$(n).siblings(".btnAddFile").val(t.name);$(n).siblings("[for=mediaorgname]").val(t.name);$(n).siblings("[for=mediaext]").val(t.type);$(n).siblings("[for=mediapath]").val("");$(n).siblings(".media_preview").remove();$(n).siblings(".btnResetFile").show()}function resetMedia(n){$(n).siblings(".btnAddFile").val("Choose media");$(n).siblings("input[type=file]").val("").attr("name","");$(n).siblings("[for=medianame]").val("");$(n).siblings("[for=mediaorgname]").val("");$(n).siblings("[for=mediaext]").val("");$(n).siblings("[for=mediapath]").val("");$(n).parent().siblings(".media_preview").remove();$(n).hide()}var Debug=!0,mod={PREVIEW:"preview",TEACHERVIEW:"teacherview",TEACHEREDIT:"teacheredit",EDIT:"edit",STUDENT_EXAM:"studentexam",STUDENT_LECTURE:"studentlecture",STUDENT_REVIEW:"studentreview"},TEMPLATE_TYPE={EXAM:2,LESSON:1},UIMode={LECTURE_ONLY:"lecture",EXAM_ONLY:"exam",BOTH:"both"},Lesson=function(){function oi(n){var t=$("#lessonModal"),i;n!=null&&n!=""&&t.find("[name=TemplateType]").val(n);i=t.find("[name=TemplateType]").val();switch(i){case"1":t.find("[for=examOnly]").hide();t.find("[for=examOnly] input").prop("required",!1);t.find("[for=examOnly] select").prop("required",!1);break;default:t.find("[for=examOnly]").show();t.find("[for=examOnly] input").prop("required",!0);t.find("[for=examOnly] select").prop("required",!0)}}var c=0,l=null,i=null,w=null,n={container:"",mod:"",url:{load:"",save:"",list_part:"",load_part:"",save_part:"",move_part:"",del_part:"",import_quiz:"",export_quiztemp:"",current:"",start:"",answer:"",removeans:"",end:"",review:""},overdue:!1,lesson_id:"",class_id:"",exam_id:""};var et=function(t){n=vr(t);console.log(n.mod);switch(n.mod){case mod.PREVIEW:case mod.TEACHEREDIT:case mod.TEACHERVIEW:y();ri();break;case mod.STUDENT_EXAM:rr();break;case mod.STUDENT_LECTURE:y();hr();break;case mod.STUDENT_REVIEW:y();sr()}window.getLocalData=f;window.ShowFullScreen=fi;var i=window.location.hash;if(i.startsWith("#")){i=i.split("#")[1];switch(i){case"redo":ft();window.history.pushState({html:document.html,pageTitle:document.title},"",window.location.href.substr(0,window.location.href.indexOf("#")))}}},ot=function(){l=null;i=null;et(n)},h=function(t,i){var r=b64EncodeUnicode(JSON.stringify(i));localStorage.setItem(n.lesson_id+"_"+n.class_subject_id+"_"+t,r)},f=function(t){var i=localStorage.getItem(n.lesson_id+"_"+n.class_subject_id+"_"+t);return i==null?null:JSON.parse(b64DecodeUnicode(i))},st=function(t){return localStorage.removeItem(n.lesson_id+"_"+n.class_subject_id+"_"+t)},s=function(n){return n==null||n==void 0||n==""||n==typeof void 0},b=function(){var i,t,n,r;if(clearTimeout(w),i=$(".time-counter").text().trim(),i!=""&&i!=null){if(t=parseInt(i.split(":")[0]),n=parseInt(i.split(":")[1]),n>0)n--;else if(t>0)t--,n=59;else{CompleteExam(!0);return}r=(t<10?"0"+t:t)+":"+(n<10?"0"+n:n);$(".time-counter").text(r);w=setTimeout(function(){b()},1e3)}},ht=function(){clearTimeout(w)},br=function(){document.location=document.location.href.replace("#","")},v=function(t,i){var r=new FormData;t!=null&&Object.keys(t).forEach(n=>r.append(n,t[n]));o(n.url.load,r,"POST",!0).then(function(t){if(!s(t)){l=JSON.parse(t).Data;switch(n.mod){case mod.PREVIEW:case mod.TEACHERVIEW:case mod.TEACHEREDIT:ct({LessonID:n.lesson_id,ClassID:n.class_id,ClassSubjectID:n.class_subject_id},i);break;case mod.STUDENT_REVIEW:ct({LessonID:n.lesson_id,ClassID:n.class_id,ClassSubjectID:n.class_subject_id,ExamID:n.exam_id},i);break;default:i()}}})},ct=function(t,i){var r=new FormData;t!=null&&Object.keys(t).forEach(n=>r.append(n,t[n]));o(n.url.list_part,r,"POST",!0).then(function(n){l.Part=JSON.parse(n).Data;i()})},y=function(){var s=$("#"+n.container),u,f,t,h,c,e,o,r;s.empty();u=$("<div>",{"class":"lesson lesson-box h-100 mod_"+n.mod});s.append(u);f=$("<div>",{"class":"lesson-container h-100"});u.append(f);t=$("<div>",{"class":"card h-100 border-0"});f.append(t);h=$("<div>",{"class":"card-header d-none",style:"display:none"});t.append(h);c=$("<div>",{"class":"card-footer",style:"display:none"});t.append(c);e=$("<div>",{"class":"card-body position-absolute pb-0",style:"top: 0; bottom: 0; left: 0; right: 0"});t.append(e);o=$("<div>",{"class":"lesson-body h-100",id:n.lesson_id});e.append(o);r=$("<div>",{id:"pills-tabContent","class":"tab-content h-100 row"});switch(i){case UIMode.EXAM_ONLY:r.append($("<div>",{"class":"col-md-4 h-100 main-column pr-2 pl-1",id:"leftCol"})).append($("<div>",{"class":"col-md-8 h-100 main-column pr-1 pl-2",id:"rightCol"}));break;default:r.append($("<div>",{"class":"col-md-6 h-100 main-column pr-2 pl-1",id:"leftCol"})).append($("<div>",{"class":"col-md-6 h-100 main-column pr-1 pl-2",id:"rightCol"}))}o.append(r);$(".main-column").addClass("scrollbar-outer").scrollbar()},a=function(){var ft=$(".top-menu[for=lesson-info]"),ot,k,d,a,v,nt,r,y,st,oi,ti,tt,ii,ri,fi;if(s(l))throw"No data";var t=l,at=$("#"+n.container),ei=at.find(".card-header"),et=at.find(".card-body"),vt=at.find(".card-footer");c=t.Part!=null?t.Part.length:0;switch(n.mod){case mod.PREVIEW:var ot=$("<div>",{"class":"justify-content-between d-none"}),w=$("<div>",{"class":"lesson-header-title"}),u=$("<h5>"),yt=$("<span>",{"class":"title-text",text:t.Title});u.append(yt);w.append(u);ot.append(w);t.TemplateType==TEMPLATE_TYPE.EXAM&&(t.Timer>0&&(k=$("<span>",{"class":"title-timer",text:" - duration: "+t.Timer+"m"}),u.append(k)),t.Point>0&&(d=$("<span>",{"class":"title-point",text:" ("+t.Point+"p)"}),u.append(d)));var e=$("<div>",{"class":"lesson-button"}),g=$("<button>",{"class":"btn btn-primary btn-sort",title:"Sắp xếp",onclick:"SortPart()"}),ht=$("<button>",{"class":"btn btn-primary btn-add",title:"Thêm","data-toggle":"modal","data-target":"#partModal",onclick:"AddPart('"+t.ID+"','"+t.TemplateType+"')"}),pt=$("<i>",{"class":"fas fa-sort mt-2 mb-2 mr-2"}),wt=$("<i>",{"class":"fas fa-plus-square mt-2 mb-2 mr-2"}),si=$("<i>",{"class":"fas fa-trash mr-2"});e.append(pt);e.append(g);g.prepend(pt).append("Sắp xếp");c>0||$(g).prop("disabled",!0);e.append(ht);ht.prepend(wt).append("Thêm nội dung");ft.empty().prepend(e);break;case mod.TEACHERVIEW:var ot=$("<div>",{"class":"d-flex justify-content-between"}),w=$("<div>",{"class":"lesson-header-title"}),u=$("<h5>"),yt=$("<span>",{"class":"title-text",text:t.Title});u.append(yt);w.append(u);ot.append(w);t.TemplateType==TEMPLATE_TYPE.EXAM&&(t.Timer>0&&(k=$("<span>",{"class":"title-timer",text:" - thời lượng: "+t.Timer+"m"}),u.append(k)),t.Point>1&&(d=$("<span>",{"class":"title-point",text:" ("+t.Point+"p)"}),u.append(d)));var e=$("<div>",{"class":"lesson-button"}),ct=$("<button>",{"class":"btn btn-primary btn-add mt-2 mb-2 mr-2",title:"Bật chế đô sửa",onclick:"SwitchMode('"+mod.TEACHEREDIT+"')"}),bt=$("<i>",{"class":"fas fa-edit mr-2"});e.append(ct);ct.append(bt).append("Sửa");ft.prepend(e);break;case mod.TEACHEREDIT:ot=$("<div>",{"class":"d-flex justify-content-between"});ei.show().append(ot);var w=$("<div>",{"class":"lesson-header-title"}),u=$("<h5>"),yt=$("<span>",{"class":"title-text",text:t.Title});u.append(yt);w.append(u);ot.append(w);t.TemplateType==TEMPLATE_TYPE.EXAM&&(t.Timer>0&&(k=$("<span>",{"class":"title-timer",text:" - duration: "+t.Timer+"m"}),u.append(k)),t.Point>0&&(d=$("<span>",{"class":"title-point",text:" ("+t.Point+"đ)"}),u.append(d)));var e=$("<div>",{"class":"lesson-button"}),g=$("<button>",{"class":"btn btn-primary btn-sort mt-2 mb-2 mr-2",title:"Sort",onclick:"SortPart()"}),ht=$("<button>",{"class":"btn btn-primary btn-add mt-2 mb-2 mr-2",title:"Add","data-toggle":"modal","data-target":"#partModal",onclick:"AddPart('"+t.ID+"','"+t.TemplateType+"')"}),ct=$("<button>",{"class":"btn btn-primary btn-add mt-2 mb-2 mr-2",title:"Về chế độ xem",onclick:"SwitchMode('"+mod.TEACHERVIEW+"')"}),pt=$("<i>",{"class":"fas fa-sort mr-2"}),wt=$("<i>",{"class":"fas fa-plus-square mr-2"}),bt=$("<i>",{"class":"fas fa-eye mr-2"});c>1||$(g).prop("disabled",!0);e.append(ct);ct.append(bt).append("Xem");e.append(g);g.append(pt).append("Sắp xếp");e.append(ht);ht.append(wt).append("Thêm nội dung");ft.append(e);break;case mod.STUDENT_EXAM:case mod.STUDENT_REVIEW:et.css("top",0);break;case mod.REVIEW:et.css("top",0)}for(r=0;t.Part!=null&&r<t.Part.length;r++){y=t.Part[r];switch(y.Type){case"QUIZ1":case"QUIZ2":case"QUIZ3":case"ESSAY":lt(UIMode.EXAM_ONLY);break;default:lt(UIMode.LECTURE_ONLY)}}console.log(i);$(".mod_"+n.mod).addClass("uimod_"+i);switch(n.mod){case mod.PREVIEW:case mod.TEACHERVIEW:case mod.TEACHEREDIT:for(a=$("<div>",{id:"part-menu","class":"w-100",style:"display:none;"}),et.append(a),v=$("<div>",{"class":"lesson-tabs"}),a.append(v),nt=$("<ul>",{id:"pills-tab","class":"nav flex-column nav-pills",role:"tablist","aria-orientation":"vertical"}),v.append(nt),r=0;t.Part!=null&&r<t.Part.length;r++)y=t.Part[r],ui(y);t.Part!=null&&t.Part.length==1&&$(".fas.fa-caret-down:first").click();i==UIMode.EXAM_ONLY&&$("#rightCol .tab-pane").each(function(){var n=null,t=null;$(this).find(".QUIZ3").length>0?($(this).addClass("h-100"),n=$(this).find(".Q3_absrow > .media-holder:first")):n=$(this).find(".quiz-wrapper > .media-holder");t=$(this).find(".part-description");$(this).addClass("m-0");$(this).clone().removeClass("tab-pane").addClass("tab-pane-quiz").empty().append($(this).find(".part-box-header")).append(n).append(t).appendTo("#leftCol")});break;case mod.STUDENT_EXAM:for(a=$("<div>",{id:"part-menu","class":"w-100",style:"display:none;"}),et.append(a),v=$("<div>",{"class":"lesson-tabs"}),a.append(v),nt=$("<ul>",{id:"pills-tab","class":"nav flex-column nav-pills",role:"tablist","aria-orientation":"vertical"}),v.append(nt),r=0;t.Part!=null&&r<t.Part.length;r++)y=t.Part[r],dt(y);i==UIMode.EXAM_ONLY&&$("#rightCol .tab-pane").each(function(){var n=null,t=null;$(this).find(".QUIZ3").length>0?($(this).addClass("h-100"),n=$(this).find(".Q3_absrow > .media-holder:first")):n=$(this).find(".quiz-wrapper > .media-holder");t=$(this).find(".part-description");$(this).addClass("m-0");$(this).clone().removeClass("tab-pane").addClass("tab-pane-quiz").empty().append($(this).find(".part-box-header")).append(n).append(t).appendTo("#leftCol")});break;case mod.STUDENT_LECTURE:for(a=$("<div>",{id:"part-menu","class":"w-100",style:"display:none;"}),et.append(a),v=$("<div>",{"class":"lesson-tabs"}),a.append(v),nt=$("<ul>",{id:"pills-tab","class":"nav flex-column nav-pills",role:"tablist","aria-orientation":"vertical"}),v.append(nt),r=0;t.Part!=null&&r<t.Part.length;r++)y=t.Part[r],dt(y);t.Part!=null&&t.Part.length==1&&$(".fas.fa-caret-down:first").click();switch(i){case UIMode.EXAM_ONLY:case UIMode.BOTH:st=new FormData;st.append("ClassID",n.class_id);st.append("ClassSubjectID",n.class_subject_id);st.append("LessonID",n.lesson_id);$("#"+n.container).find("#ExamID").length==0&&$("#"+n.container).prepend($("<input>",{type:"hidden",name:"ExamID",id:"ExamID"}));gt()||localStorage.clear();oi=!1;o(n.url.current,st,"POST",!0).then(function(n){var t,i;try{i=JSON.parse(n);t=i.exam}catch(r){console.log(r)}t==null?(localStorage.clear(),console.log("New Fresh Exam"),it(t,!1)):s(f("CurrentExam"))||f("CurrentExam")!=t.ID?(localStorage.clear(),console.log("New Exam"),it(t,!1)):(h("CurrentExam",t.ID),$("#ExamID").val(t.ID),it(t,!0))})}}switch(n.mod){case mod.PREVIEW:case mod.TEACHERVIEW:case mod.TEACHEREDIT:if(i==UIMode.EXAM_ONLY){var ft=$(".top-menu[for=lesson-info]"),tt=$("<div>",{"class":"row"}),rt=$("<button>",{"class":"prevtab btn btn-primary mt-2 mb-2 mr-2",title:"Câu trước",onclick:"PrevPart()"}),kt=$("<i>",{"class":"fas fa-arrow-circle-left mr-2"}),ut=$("<button>",{"class":"nexttab btn btn-primary mt-2 mb-2 ml-2",title:"Câu tiếp",onclick:"NextPart()"}),ni=$("<i>",{"class":"fas fa-arrow-circle-right ml-2"});rt.append(kt).append("Câu trước");ut.append(ni).prepend("Câu sau");rt.prop("disabled",!0);c<=1&&ut.prop("disabled",!0);ti=$("<button>",{"class":"btn btn-primary mt-2 mb-2",title:"Bật/tắt giải thích",onclick:"ToggleExplanation(this)"}).append('<i class="fas fa-info-circle mr-2"><\/i>').append("Giải thích");ft.append(rt).append(ti).append(ut)}else vt.hide();break;case mod.STUDENT_EXAM:tt=ft;tt.empty();var rt=$("<button>",{"class":"prevtab btn btn-primary m-2",title:"Câu trước",onclick:"PrevPart()"}),kt=$("<i>",{"class":"fas fa-arrow-circle-left mr-2"}),ut=$("<button>",{"class":"nexttab btn btn-primary m-2",title:"Câu tiếp",onclick:"NextPart()"}),ni=$("<i>",{"class":"fas fa-arrow-circle-right mr-2"});rt.append(kt).append("Câu trước");ut.append(ni).append("Câu sau");rt.prop("disabled",!0);c<=1&&ut.prop("disabled",!0);tt.append(rt);vt.append($("<div>",{id:"quizIdx_holder"}));vt.addClass("expand");ii=$("<div>",{id:"quiz-counter-holder","class":"text-white font-weight-bold align-middle"});tt.append(ii);ri=$("<button>",{"class":"btn btn-primary mt-2 mb-2",onclick:"CompleteExam()"}).append('<i class="fas fa-save mr-2"><\/i>').append("Nộp bài");fi=$("<div>",{id:"bottom-counter","class":"font-weight-bold m-2 text-danger",style:"font-size:200%"}).append('<i class="far fa-clock mr-2" style="font-size:85%"><\/i>').append($("<span>",{"class":"time-counter "}));tt.prepend(fi).append(ri);p();$(".time-counter").html(f("Timer"));b();tt.append(ut)}},lt=function(t){var f=$("#"+n.container),r=f.find("#leftCol"),u=f.find("#rightCol");if(i!=UIMode.BOTH&&t!=i){i=s(i)?t:UIMode.BOTH;switch(i){case UIMode.LECTURE_ONLY:r.parent().removeClass("col-md-6").removeClass("col-md-12").addClass("col-md-12").show();u.parent().hide();break;case UIMode.EXAM_ONLY:r.parent().removeClass("col-md-6").removeClass("col-md-12").addClass("col-md-4").show();u.parent().removeClass("col-md-6").removeClass("col-md-12").addClass("col-md-8").show();break;case UIMode.BOTH:r.parent().removeClass("col-md-6").removeClass("col-md-4").removeClass("col-md-12").addClass("col-md-6").show();u.parent().removeClass("col-md-6").removeClass("col-md-8").removeClass("col-md-12").addClass("col-md-6").show()}}},ii=function(t){n.mod=t;$(".top-menu[for=lesson-info]").empty();ot()},ri=function(){s(l)?v({ID:n.lesson_id},a):a()},ui=function(r){var nt=$("#"+n.container),tt=nt.find("#leftCol"),it=nt.find("#rightCol"),p="",rt="",h,w,v,s,e,f,l,c,y,d,u,o,a;r.Timer>0&&(p=" ("+r.Timer+"m)");r.Point>0&&(rt=" ("+r.Point+"p)");h=$(tt);(r.Type.toString().startsWith("QUIZ")||r.Type=="ESSAY")&&(h=$(it));w=$("#part-menu #pills-tab");v=null;$("li #pills-"+r.ID).length>0?v=$("li #pills-"+r.ID).parent().empty():(v=$("<li>",{"class":"nav-item"}),w.append(v));s=$("<a>",{id:"pills-"+r.ID,"class":"nav-link","data-toggle":"pill",href:"#pills-part-"+r.ID,role:"tab","aria-controls":"pills-"+r.ID,"aria-selected":"false",text:r.Title});v.append(s);e=null;e=$("#pills-part-"+r.ID).length>0?$("#pills-part-"+r.ID).empty():$("<div>",{id:"pills-part-"+r.ID,"class":"tab-pane"+(i==UIMode.EXAM_ONLY?" hide":"")+" w-100",role:"tabpanel","aria-labelledby":"pills-"+r.ID});f=$("<div>",{"class":"part-box "+r.Type,id:r.ID});e.append(f);l=$("<div>",{"class":"row "+(i==UIMode.EXAM_ONLY?" Q3_absrow":"")});c=$("<div>",{"class":"part-box-header row"});switch(n.mod){case mod.PREVIEW:case mod.TEACHEREDIT:c.append($("<h5>",{"class":"title col-md-10 font-weight-bold",text:(r.Title==null?"":r.Title)+p}));var ut=$("<i>",{"class":"fas fa-edit"}),ft=$("<i>",{"class":"fas fa-trash"}),b=$("<div>",{"class":"text-right col-md-2"});b.append($("<button>",{"class":"btn btn-primary btn-sm mr-1 ml-1",style:"width: 40px",title:"Sửa","data-toggle":"modal","data-target":"#partModal",onclick:"EditPart('"+r.ID+"')"}).append(ut));b.append($("<button>",{"class":"btn btn-danger btn-sm mr-1 ml-1",style:"width: 40px",title:"Xóa",onclick:"RemovePart('"+r.ID+"')"}).append(ft));c.append(b);break;default:c.append($("<h5>",{"class":"title col-md-12",text:(r.Title==null?"":r.Title)+p}))}f.append(c);y=$("<i>",{"class":"fas fa-caret-down pl-2 pr-2 pt-1 pb-1",style:"cursor:pointer",onclick:"toggleExpand(this)"});switch(r.Type){case"TEXT":u=$("<div>",{"class":"content-wrapper"});r.Description!=null&&u.append($("<div>",{"class":"doc-content"}).html(r.Description));s.prepend($("<i>",{"class":"far fa-file-word"}));f.append(u);h.append(e);break;case"IMG":c.find(".title").append(y);u=$("<div>",{"class":"media-wrapper collapsable collapse"});r.Description!=null&&u.append($("<div>",{"class":"d-flex justify-content-center"}).append($("<div>",{"class":"part-description"}).html(r.Description)));t(r,u,"IMG");s.prepend($("<i>",{"class":"fas fa-file-image"}));f.append(u);h.append(e);break;case"AUDIO":c.find(".title").append(y);u=$("<div>",{"class":"media-wrapper collapsable collapse"});r.Description!=null&&u.append($("<div>",{"class":"d-flex justify-content-center"}).append($("<div>",{"class":"part-description"}).html(r.Description)));t(r,u,"AUDIO");s.prepend($("<i>",{"class":"fas fa-music"}));f.append(u);h.append(e);break;case"VIDEO":c.find(".title").append(y);u=$("<div>",{"class":"media-wrapper collapsable collapse"});r.Description!=null&&u.append($("<div>",{"class":"d-flex justify-content-center"}).append($("<div>",{"class":"part-description"}).html(r.Description)));t(r,u,"VIDEO");s.prepend($("<i>",{"class":"far fa-play-circle"}));f.append(u);h.append(e);break;case"DOC":c.find(".title").append(y);u=$("<div>",{"class":"media-wrapper collapsable collapse"});r.Description!=null&&u.append($("<div>",{"class":"d-flex justify-content-center"}).append($("<div>",{"class":"part-description"}).html(r.Description)));t(r,u,"DOC");s.prepend($("<i>",{"class":"fas fa-file-word"}));f.append(u);h.append(e);break;case"QUIZ1":case"QUIZ2":for(u=$("<div>",{"class":"quiz-wrapper"}),s.prepend($("<i>",{"class":"fab fa-leanpub"})),f.append(u),t(r,u,""),h.append(e),r.Description!=null&&u.append($("<div>",{"class":"part-description"}).html(r.Description)),totalQuiz=r.Questions.length,o=0;r.Questions!=null&&o<r.Questions.length;o++)a=r.Questions[o],k(a,r.Type);break;case"QUIZ3":for(f.append(l),u=$("<div>",{"class":"quiz-wrapper col-8"}),s.prepend($("<i>",{"class":"fab fa-leanpub"})),t(r,l,""),l.append(u),r.Description!=null&&l.append($("<div>",{"class":"part-description"}).html(r.Description)),l.find(".media-holder").addClass("col-12"),d=$("<div>",{"class":"answer-wrapper no-child col-4","data-part-id":r.ID}),l.append(d),$(d).droppable({tolerance:"intersect",accept:".answer-item",activeClass:"hasAnswer",hoverClass:"answerHover",drop:function(n,t){var i=t.helper.data("parent");$(i).find(".placeholder").show();$(this).append($(t.draggable))}}),h.append(e),totalQuiz=r.Questions.length,o=0;r.Questions!=null&&o<r.Questions.length;o++)a=r.Questions[o],k(a,r.Type);break;case"ESSAY":for(u=$("<div>",{"class":"content-wrapper"}),r.Description!=null&&u.append($("<div>",{"class":"part-description"}).html(r.Description)),s.prepend($("<i>",{"class":"fab fa-leanpub"})),f.append(u),h.append(e),u=$("<div>",{"class":"quiz-wrapper"}),f.append(u),t(r,u,""),totalQuiz=r.Questions.length,o=0;r.Questions!=null&&o<r.Questions.length;o++)a=r.Questions[o],k(a,r.Type)}f.find("iframe,embed,video").each(function(n,t){$(t).wrap($("<div>",{"class":"fullscreenSupport d-inline-block"}));$(t).parent().append($("<div>").append($("<button>",{"class":"btn btn-primary mt-1",click:function(){ShowFullScreen(this)}}).append('<i class="ic fa fa-expand mr-2"><\/i>').append("Xem toàn màn hình")))});typeof WirisPlugin!="undefined"&&f.html(WirisPlugin.Parser.initParse(f.html()));w.find(".nav-item").length==1&&(s.addClass("active"),e.addClass("show active"));$(".Q3_absrow .quiz-wrapper").addClass("h-100").addClass("scrollbar-outer").scrollbar();$(".Q3_absrow .answer-wrapper").addClass("h-100").addClass("scrollbar-outer").scrollbar();g()},fi=function(n){$(n).parent().siblings("iframe,embed,video")[0].webkitRequestFullscreen()},k=function(i,r){var y="",a,l,h,f,c;i.Point>0&&(y=" ("+i.Point+"p)");switch(r){case"QUIZ2":var v=$("#"+i.ParentID+" .quiz-wrapper"),e=$("<div>",{"class":"quiz-item",id:i.ID,"data-part-id":i.ParentID}),o=$("<div>",{"class":"quiz-box-header"});for(o.append($("<div>",{"class":"quiz-text",html:u(i.Content)})),t(i,o),e.append(o),v.append(e),l=$("<div>",{"class":"answer-wrapper"}),e.append(l),i.Description!==""&&(h=$("<div>",{"class":"quiz-extend",html:u(i.Description)}),e.append(h)),f=0;i.Answers!=null&&f<i.Answers.length;f++)c=i.Answers[f],d(c,r);break;case"QUIZ3":var v=$("#"+i.ParentID+" .quiz-wrapper"),e=$("<div>",{"class":"quiz-item",id:i.ID,"data-part-id":i.ParentID}),p=$("<div>",{"class":"quiz-pane col-6"}),w=$("<div>",{"class":"answer-pane no-child col-6","data-question-id":i.ID,"data-part-id":i.ParentID,"data-lesson-id":n.lesson_id,"data-type":r});for(e.append(p),e.append(w),i.Description!==""&&(h=$("<div>",{"class":"quiz-extend",html:u(i.Description)}),e.append(h)),a=$("<div>",{"class":"pane-item"}),i.Media==null?a.append($("<div>",{"class":"quiz-text",html:u(i.Content)})):t(i,a),p.append(a),v.append(e),$(w).droppable({tolerance:"intersect",accept:".answer-item",activeClass:"hasAnswer",hoverClass:"answerHover",drop:function(n,t){$(this).find(".placeholder").hide();var i=t.helper.data("parent");$(this).find(".answer-item").length>0?$(i).append($(this).find(".answer-item")):$(i).find(".placeholder").show();$(this).append($(t.draggable))}}),f=0;i.Answers!=null&&f<i.Answers.length;f++)c=i.Answers[f],d(c,r);break;default:var v=$("#"+i.ParentID+" .quiz-wrapper"),s=$("<div>",{"class":"quiz-item",id:i.ID,"data-part-id":i.ParentID}),o=$("<div>",{"class":"quiz-box-header"});if(i.Content!=null?o.append($("<h5>",{"class":"title",html:u(i.Content)})):o.append($("<h5>",{"class":"title",text:y})),t(i,o),s.append(o),l=$("<div>",{"class":"answer-wrapper"}),s.append(l),i.Description!==""&&(h=$("<div>",{"class":"quiz-extend",html:u(i.Description)}),s.append(h)),v.append(s),r=="ESSAY")s.append($("<div>",{"class":"mb-2"}).append($("<textarea>",{id:"editor",rows:"5",name:"Description","class":"input-text form-control",placeholder:"Enter content"}))),i!=null&&i.Description!=null&&s.find("[name=Description]").val(i.Description),CKEDITOR.replace("editor"),s.append($("<div>",{"class":"mb-2 text-right"}).append($("<button>",{"class":"btn btn-primary mr-2",text:"File đính kèm",disabled:!0})).append($("<button>",{"class":"btn btn-primary",text:"Lưu",disabled:!0})));else for(f=0;i.Answers!=null&&f<i.Answers.length;f++)c=i.Answers[f],d(c,r)}},d=function(n,i){var f=$("#"+n.ParentID+" .answer-wrapper"),r=$("<fieldset>",{"class":"answer-item",id:n.ID}),s,o,e;switch(i){case"QUIZ2":$(f).find(".answer-item").length==0?(r.append($("<input>",{type:"text","class":"input-text answer-text form-control",placeholder:n.Content})),f.append(r)):(s=$(f).find(".answer-text").attr("placeholder"),$(f).find(".answer-text").attr("placeholder",s+" | "+n.Content));break;case"QUIZ3":o=$("#"+n.ParentID).find(".answer-pane");$(o).removeClass("no-child");o.empty().append($("<div>",{"class":"pane-item placeholder",text:"Drop your answer here"}));f=$("#"+n.ParentID).parent().siblings(".answer-wrapper");n.Content!=null&&r.append($("<input>",{type:"hidden",value:n.Content}));n.Media!=null?t(n,r):r.append($("<label>",{"class":"answer-text",html:u(n.Content)}));f.append(r);break;default:e=$("<div>",{"class":"form-check"});r.append(e);e.append($("<input>",{type:"hidden"}));e.append($("<input>",{id:n.ID,type:"radio","class":"input-checkbox answer-checkbox form-check-input",name:"rd_"+n.ParentID}));n.Content!=null&&e.append($("<label>",{"class":"answer-text form-check-label","for":n.ID,html:u(n.Content)}));t(n,r);f.append(r)}},t=function(n,t,i=""){if(console.log(n),n.Media!=null){var r=$("<div>",{"class":"media-holder mt-2 mb-2 "+i});switch(i){case"IMG":r.append($("<img>",{"class":"img-fluid lazy",src:n.Media.Path.replace("http://publisher.edusolution.vn","https://publisher.eduso.vn")}));break;case"VIDEO":r.append("<video controls><source src='"+n.Media.Path.replace("http://publisher.edusolution.vn","https://publisher.eduso.vn")+"' type='"+n.Media.Extension+"' />Your browser does not support the video tag<\/video>");break;case"AUDIO":r.append("<audio id='audio' controls><source src='"+n.Media.Path.replace("http://publisher.edusolution.vn","https://publisher.eduso.vn")+"' type='"+n.Media.Extension+"' />Your browser does not support the audio tag<\/audio>");break;case"DOC":n.Media.Path.endsWith("doc")||n.Media.Path.endsWith("docx")||n.Media.Path.endsWith("ppt")||n.Media.Path.endsWith("pptx")||n.Media.Path.endsWith("xls")||n.Media.Path.endsWith("xlsx")?r.append($("<iframe>",{src:"https://view.officeapps.live.com/op/embed.aspx?src=https://"+window.location.hostname+n.Media.Path+"","class":"embed-frame",frameborder:"0"})):n.Media!=null&&r.append($("<embed>",{src:n.Media.Path.replace("http://publisher.edusolution.vn","https://publisher.eduso.vn")+"#view=FitH","class":"embed-frame"}));break;default:n.Media.Extension!=null&&(n.Media.Extension.indexOf("image")>=0?r.append($("<img>",{"class":"img-fluid lazy",src:n.Media.Path.replace("http://publisher.edusolution.vn","https://publisher.eduso.vn")})):n.Media.Extension.indexOf("video")>=0?r.append("<video controls><source src='"+n.Media.Path.replace("http://publisher.edusolution.vn","https://publisher.eduso.vn")+"' type='"+n.Media.Extension+"' />Your browser does not support the video tag<\/video>"):n.Media.Extension.indexOf("audio")>=0?r.append("<audio id='audio' controls><source src='"+n.Media.Path.replace("http://publisher.edusolution.vn","https://publisher.eduso.vn")+"' type='"+n.Media.Extension+"' />Your browser does not support the audio tag<\/audio>"):n.Media.Path.endsWith("doc")||n.Media.Path.endsWith("docx")||n.Media.Path.endsWith("ppt")||n.Media.Path.endsWith("pptx")||n.Media.Path.endsWith("xls")||n.Media.Path.endsWith("xlsx")?r.append($("<iframe>",{src:"https://view.officeapps.live.com/op/embed.aspx?src=https://"+window.location.hostname+n.Media.Path+"","class":"embed-frame",frameborder:"0"})):r.append($("<embed>",{src:n.Media.Path.replace("http://publisher.edusolution.vn","https://publisher.eduso.vn")+"#view=FitH"})))}t.append(r)}},g=function(){$(".answer-item").draggable({cursor:"move",helper:"clone",revert:"true",scroll:!0,start:function(){var n=$(this).parent();n.hasClass("answer-wrapper")?(n.addClass("dragging"),$(".quiz-wrapper").addClass("dragtarget")):($(".answer-wrapper").addClass("droptarget"),$(".quiz-wrapper").addClass("dragging"))},stop:function(){$(".quiz-wrapper").removeClass("dragging").removeClass("droptarget");$(".answer-wrapper").removeClass("dragging").removeClass("droptarget")}});$(".answer-pane.ui-droppable").droppable({tolerance:"intersect",accept:".answer-item",activeClass:"hasAnswer",hoverClass:"answerHover",drop:function(n,t){var f=$(t.draggable),i=$(t.helper).parent(),u,r;if(i.remove($(t.helper)),r=i.data("questionId"),$(i).attr("data-question-id")==$(this).attr("data-question-id"))return!1;u=$(i).attr("data-part-id");console.log(u);console.log($("#"+u+" .answer-wrapper"));$(this).find(".answer-item").length>0&&$("#"+u+" .answer-wrapper").append($(this).find(".answer-item"));$(this).append(f);$(i).find(".answer-item").length==1&&($(i).find(".placeholder").length>0?$(i).find(".placeholder").show():$(i).append($("<div>",{"class":"pane-item placeholder",text:"Drop your answer here"})));r=i.data("questionId");r!=null&&yr(r);ni(this);$(this).find(".placeholder").hide()}});$(".answer-wrapper.no-child[data-part-id]").droppable({tolerance:"intersect",accept:".answer-item",activeClass:"hasAnswer",hoverClass:"answerHover",drop:function(t,i){var r,u;$(this).find(".placeholder").hide();r=$(i.helper).parent();n.mod==mod.STUDENT_EXAM&&(u=r.data("questionId"),u!=null&&ti(u));r.remove($(i.helper));$(this).append($(i.draggable));$(r).find(".answer-item").length==1&&($(r).find(".placeholder").length>0?$(r).find(".placeholder").show():r.append($("<div>",{"class":"pane-item placeholder",text:"Drop your answer here"})))}})},u=function(n){return n==null?"":n.replace(/\n/g,"<br/>")},ei=function(n){$(n).toggleClass("btn-warning");$(n).hasClass("btn-warning")?$(".quiz-extend:not(.show)").addClass("show"):$(".quiz-extend").removeClass("show")};var si=function(t){var i=$("#lessonModal");return $.ajax({type:"POST",url:n.url.load,data:{ID:t},dataType:"json",success:function(n){if(n.Data!=null){var t=n.Data;SelectTemplate(t.TemplateType);i.find("[name=Title]").val(t.Title);i.find("[name=ChapterID]").val(t.ChapterID);i.find("[name=ID]").val(t.ID);i.find("[name=Point]").val(t.Point);i.find("[name=Timer]").val(t.Timer);i.find("[name=Limit]").val(t.Limit);i.find("[name=Multiple]").val(t.Multiple);i.find("[name=Etype]").val(t.Etype)}else alert("Error")}}),!1},hi=function(t){stopAllMedia();var i=window.partForm;$("#action").val(n.url.save_part);$(i).empty();$.ajax({type:"POST",url:n.url.load_part,data:{ID:t},dataType:"json",success:function(n){li(n.Data)}})},ci=function(t){var i=window.partForm,r;$(i).empty();$("#partModal #modalTitle").html("Thêm nội dung");$(i).append($("<input>",{type:"hidden",name:"ParentID",value:t}));$(i).append($("<input>",{type:"hidden",name:"ClassID",value:n.class_id}));$(i).append($("<input>",{type:"hidden",name:"ClassSubjectID",value:n.class_subject_id}));$("#action").val(n.url.save_part);r=$("<select>",{"class":"templatetype form-control",name:"Type",required:"required"}).bind("change",pi);$(i).append(r);$(r).append("<option value=''>--- Chọn kiểu nội dung ---<\/option>");$(r).append("<option value='TEXT'>Văn bản<\/option>").append("<option value='VIDEO'>Video<\/option>").append("<option value='AUDIO'>Audio<\/option>").append("<option value='IMG'>Hình ảnh<\/option>").append("<option value='DOC'>File văn bản (PDF, DOC, PPT, XLS)<\/option>");$(r).append("<option value='QUIZ1'>QUIZ: Chọn đáp án đúng<\/option>").append("<option value='QUIZ2'>QUIZ: Điền từ<\/option>").append("<option value='QUIZ3'>QUIZ: Nối đáp án<\/option>");$(i).append($("<div>",{"class":"lesson_parts"}));$(i).append($("<div>",{"class":"question_template hide"}));$(i).append($("<div>",{"class":"answer_template hide"}))},li=function(t){var i=window.partForm;$("#partModal #modalTitle").html("Update");$(i).append($("<input>",{type:"hidden",name:"ParentID",value:t.ParentID}));$(i).append($("<input>",{type:"hidden",name:"ClassID",value:n.class_id}));$(i).append($("<input>",{type:"hidden",name:"ClassSubjectID",value:n.class_subject_id}));$(i).append($("<input>",{type:"hidden",name:"ID",value:t.ID}));$(i).append($("<input>",{type:"hidden",name:"Type",value:t.Type}));$("#action").val(n.url.save_part);$(i).append($("<div>",{"class":"lesson_parts"}));$(i).append($("<div>",{"class":"question_template hide"}));$(i).append($("<div>",{"class":"answer_template hide"}));at(t.Type,t)},ai=function(t){Swal.fire({title:"Xóa nội dung này?",text:"Bạn sẽ không thể khôi phục lại sau khi xóa!",icon:"warning",showCancelButton:!0,focusConfirm:!1,confirmButtonColor:"#d33",cancelButtonColor:"#CCC",cancelButtonText:"Hủy",confirmButtonText:"Đồng ý xóa!"}).then(i=>{i.value&&$.ajax({type:"POST",url:n.url.del_part,data:{ID:t},success:function(n){n.Error==null?document.location=document.location:alert(n.Error)}})})},vi=function(t,i){$.ajax({type:"POST",url:n.url.move_part,data:{ID:t,pos:i,ClassID:n.class_id},success:function(n){console.log(n.message)}})},yi=function(){$("#pills-tab").toggleClass("sorting");$("#pills-tab").hasClass("sorting")?($("#part-menu").show(),$(".card-header .btn-sort").addClass("btn-warning"),$("#pills-tab").sortable({revert:"invalid",update:function(n,t){var i=$(t.item).find("a").attr("id").replace("pills-",""),r=$(this).find("li"),u=$(r).index(t.item);vi(i,u)}}),$("#pills-tab").sortable("enable"),$("#pills-tab").disableSelection()):($("#part-menu").hide(),$(".card-header .btn-sort").removeClass("btn-warning"),$("#pills-tab").sortable("disable"),window.ReloadData())},pi=function(){var n=$(".templatetype").val();at(n)},at=function(n,i=null){var u=$(".lesson_parts"),v,a,o,s,c,f,y,h,l;u.empty();v=$(".question_template");v.empty();a=$(".answer_template");a.empty();u.append($("<label>",{"class":"title",text:"Tiêu đề:"}));u.append($("<input>",{type:"text",name:"Title","class":"input-text form-control",placeholder:"Tiêu đề"}));i!=null&&i.Title!=null&&u.find("[name=Title]").val(i.Title);u.append($("<div>",{"class":"mb-2"}).append($("<textarea>",{id:"editor",rows:"5",name:"Description","class":"input-text form-control",placeholder:"Nội dung"})));i!=null&&i.Description!=null&&u.find("[name=Description]").val(i.Description);switch(n){case"TEXT":u.append($("<label>",{"class":"title",text:"Nhập nội dung"}));u.append($("#editor"));break;case"VIDEO":u.append($("<label>",{"class":"title",text:"Chọn file video"}));u.append($("<div>",{"class":"media_holder"}));r(u.find(".media_holder"),"","VIDEO",i!=null?i.Media:null);u.append($("<div>",{"class":"media_preview"}));break;case"AUDIO":u.append($("<label>",{"class":"title",text:"Chọn file audio"}));u.append($("<div>",{"class":"media_holder"}));r(u.find(".media_holder"),"","AUDIO",i!=null?i.Media:null);u.append($("<div>",{"class":"media_preview"}));break;case"IMG":u.append($("<label>",{"class":"title",text:"Chọn hình ảnh"}));u.append($("<div>",{"class":"media_holder"}));r(u.find(".media_holder"),"","IMG",i!=null?i.Media:null);u.append($("<div>",{"class":"media_preview"}));break;case"DOC":u.append($("<label>",{"class":"title",text:"Chọn văn bản (pdf, doc, ppt, xls)"}));u.append($("<div>",{"class":"media_holder"}));r(u.find(".media_holder"),"","DOC",i!=null?i.Media:null);u.append($("<div>",{"class":"media_preview"}));break;case"QUIZ1":if(o=$("<fieldset>",{"class":"fieldQuestion",Order:0}),o.append($("<input>",{type:"hidden",name:"Questions.ID"})),o.append($("<input>",{type:"hidden",name:"Questions.Order",value:0})),o.append($("<label>",{"class":"fieldset_title",text:""})),o.append($("<input>",{type:"button","class":"quiz-remove",value:"X",tabindex:-1,onclick:"RemoveQuestion(this)"})),o.append($("<textarea>",{rows:"3",name:"Questions.Content","class":"input-text quiz-text form-control",placeholder:"Question"})),o.append($("<div>",{"class":"media_holder"})),r(o.find(".media_holder"),"Questions."),o.append($("<div>",{"class":"media_preview"})),o.append($("<div>",{"class":"mt-1 d-none"}).append($("<label>",{"class":"input_label mr-1",text:"Điểm"})).append($("<input>",{type:"text",name:"Questions.Point","class":"input-text part_point form-control",placeholder:"Point",value:"1"}))),o.append($("<div>",{"class":"mt-1"}).append($("<label>",{"class":"part_label",text:"Answer (tick if correct)"}))),c=$("<div>",{"class":"answer-wrapper"}),c.append($("<input>",{type:"button","class":"btn btn-primary btnAddAnswer ml-3",value:"+",onclick:"AddNewAnswer(this)"})),o.append(c),o.append($("<textarea>",{rows:"2",name:"Questions.Description","class":"input-text part_description form-control",placeholder:"Explanation"})),v.append(o),f=$("<fieldset>",{"class":"answer-box m-1"}),f.append($("<input>",{type:"button","class":"answer-remove",value:"X",tabindex:-1,onclick:"RemoveAnswer(this)"})),f.append($("<input>",{type:"hidden",name:"Questions.Answers.ID"})),f.append($("<input>",{type:"hidden",name:"Questions.Answers.ParentID",value:0})),f.append($("<input>",{type:"hidden",name:"Questions.Answers.IsCorrect"})),f.append($("<input>",{type:"checkbox","class":"input-checkbox answer-checkbox",onclick:"ToggleCorrectAnswer(this)"})),f.append($("<input>",{type:"text",name:"Questions.Answers.Content","class":"input-text answer-text form-control",placeholder:"Answer"})),f.append($("<div>",{"class":"media_holder mt-1"})),r(f.find(".media_holder"),"Questions.Answers."),f.append($("<div>",{"class":"media_preview"})),a.append(f),u.append($("<div>",{"class":"media_holder"})),u.append($("<div>",{"class":"media_preview"})),r(u.find(".media_holder"),"","",i!=null?i.Media:null),u.append($("<div>",{"class":"part_content "+n})),u.append($("<button>",{type:"button","class":"btn btnAddQuestion btn-primary",onclick:"AddNewQuestion(this)"}).append('<i class="fas fa-plus"><\/i>').append(" Thêm câu hỏi")),u.append($("<button>",{type:"button","class":"btn btnCloneQuestion btn-primary ml-2",onclick:"ShowCloneQuestion(this)"}).append('<i class="fas fa-plus"><\/i>').append(" Thêm từ file")),i!=null&&i.Questions!=null)for(h=0;i.Questions!=null&&h<i.Questions.length;h++)l=i.Questions[h],e(l);else e();break;case"QUIZ2":if(o=$("<fieldset>",{"class":"fieldQuestion",Order:0}),s=$("<div>",{"class":"quiz-wrapper"}),s.append($("<input>",{type:"hidden",name:"Questions.ID"})),s.append($("<input>",{type:"hidden",name:"Questions.Order",value:0})),s.append($("<label>",{"class":"fieldset_title",text:""})),s.append($("<input>",{type:"button","class":"quiz-remove",value:"X",tabindex:-1,onclick:"RemoveQuestion(this)"})),s.append($("<input>",{name:"Questions.Content","class":"input-text quiz-text form-control",placeholder:"Position (skip for media content)"})),s.append($("<label>",{"class":"input_label mr-1 d-none",text:"Điểm"})),s.append($("<input>",{type:"text",name:"Questions.Point","class":"input-text part_point form-control",placeholder:"Point",value:"1"})),s.append($("<div>",{"class":"media_holder"})),r(s.find(".media_holder"),"Questions."),s.append($("<div>",{"class":"media_preview"})),o.append(s),c=$("<div>",{"class":"answer-wrapper"}),c.append($("<input>",{type:"button","class":"btn btn-primary btnAddAnswer ml-3",value:"+",onclick:"AddNewAnswer(this)"})),o.append(c),o.append($("<textarea>",{rows:"2",name:"Questions.Description","class":"input-text part_description form-control",placeholder:"Explanation"})),v.append(o),f=$("<fieldset>",{"class":"answer-box m-1"}),f.append($("<input>",{type:"button","class":"answer-remove",value:"X",tabindex:-1,onclick:"RemoveAnswer(this)"})),f.append($("<input>",{type:"hidden",name:"Questions.Answers.ID"})),f.append($("<input>",{type:"hidden",name:"Questions.Answers.ParentID",value:0})),f.append($("<input>",{type:"hidden",name:"Questions.Answers.IsCorrect",value:!0})),f.append($("<input>",{type:"text",name:"Questions.Answers.Content","class":"input-text answer-text form-control",placeholder:"Answer"})),a.append(f),u.append($("<div>",{"class":"media_holder"})),r(u.find(".media_holder"),"","",i!=null?i.Media:null),u.append($("<div>",{"class":"media_preview"})),u.append($("<div>",{"class":"part_content "+n})),u.append($("<input>",{type:"button","class":"btn btnAddQuestion bnt-primary",value:"Add question",tabindex:-1,onclick:"AddNewQuestion(this)"})),u.append($("<button>",{type:"button","class":"btn btnCloneQuestion btn-primary ml-2",onclick:"ShowCloneQuestion(this)"}).append('<i class="fas fa-plus"><\/i>').append(" Thêm từ file")),i!=null&&i.Questions!=null)for(h=0;i.Questions!=null&&h<i.Questions.length;h++)l=i.Questions[h],e(l);else e();break;case"QUIZ3":if(o=$("<fieldset>",{"class":"fieldQuestion",Order:0}),o.append($("<input>",{type:"hidden",name:"Questions.ID"})),o.append($("<input>",{type:"hidden",name:"Questions.Order",value:0})),o.append($("<label>",{"class":"fieldset_title",text:""})),o.append($("<input>",{type:"button","class":"quiz-remove",value:"X",tabindex:-1,onclick:"RemoveQuestion(this)"})),s=$("<div>",{"class":"quiz-wrapper"}),s.append($("<input>",{type:"text",name:"Questions.Content","class":"input-text quiz-text form-control input-sm",placeholder:"Question",tabindex:0})),s.append($("<div>",{"class":"media_holder"})),r(s.find(".media_holder"),"Questions."),s.append($("<div>",{"class":"media_preview"})),s.append($("<label>",{"class":"input_label d-none",text:"Điểm "})),s.append($("<input>",{type:"text",name:"Questions.Point","class":"d-none input-text part_point form-control",placeholder:"Point",value:"1",tabindex:0})),o.append(s),c=$("<div>",{"class":"answer-wrapper"}),c.append($("<input>",{type:"button","class":"btn btn-primary btnAddAnswer ml-3",value:"+",tabindex:-1,onclick:"AddNewAnswer(this)"})),o.append(c),v.append(o),f=$("<fieldset>",{"class":"answer-box m-1 selected"}),f.append($("<input>",{type:"button","class":"answer-remove",value:"X",tabindex:-1,onclick:"RemoveAnswer(this)"})),f.append($("<input>",{type:"hidden",name:"Questions.Answers.ID"})),f.append($("<input>",{type:"hidden",name:"Questions.Answers.ParentID",value:0})),f.append($("<input>",{type:"hidden",name:"Questions.Answers.IsCorrect",value:!0})),f.append($("<input>",{type:"checkbox","class":"input-checkbox answer-checkbox",checked:"checked",tabindex:0,onclick:"ToggleCorrectAnswer(this)"})),f.append($("<input>",{type:"text",name:"Questions.Answers.Content","class":"input-text answer-text form-control",placeholder:"Answer (tick if correct)",tabindex:0})),f.append($("<div>",{"class":"media_holder"})),r(f.find(".media_holder"),"Questions.Answers."),f.append($("<div>",{"class":"media_preview"})),y=Math.floor(Math.random()*2),y>0?a.append(f):a.prepend(f),u.append($("<div>",{"class":"media_holder"})),r(u.find(".media_holder"),"","",i!=null?i.Media:null),u.append($("<div>",{"class":"media_preview"})),u.append($("<div>",{"class":"part_content "+n})),u.append($("<input>",{type:"button","class":"btn btnAddQuestion btn-primary",value:"Add question",onclick:"AddNewQuestion(this)",tabindex:-1})),u.append($("<button>",{type:"button","class":"btn btnCloneQuestion btn-primary ml-2",onclick:"ShowCloneQuestion(this)"}).append('<i class="fas fa-plus"><\/i>').append(" Thêm từ file")),i!=null&&i.Questions!=null)for(h=0;i.Questions!=null&&h<i.Questions.length;h++)l=i.Questions[h],e(l);else e();break;case"ESSAY":if(u.append($("<label>",{"class":"title",text:"Điểm"})),u.append($("<input>",{type:"text",name:"Point","class":"input-text form-control",placeholder:"Điểm",required:"required",value:i.Point})),u.append($("<div>",{"class":"media_holder"})),r(u.find(".media_holder"),"","",i!=null?i.Media:null),u.append($("<div>",{"class":"media_preview"})),u.append($("<div>",{"class":"part_content "+n})),i!=null&&i.Questions!=null)for(h=0;i.Questions!=null&&h<i.Questions.length;h++)l=i.Questions[h],e(l);else e();break;default:alert("Not implement")}CKEDITOR.plugins.addExternal("ckeditor_wiris","https://www.wiris.net/demo/plugins/ckeditor/","plugin.js");CKEDITOR.replace("editor",{allowedContent:!0,extraPlugins:"uploadimage,youtube,ckeditor_wiris"});i!=null&&i.Media!=null&&t(i,u.find(".media_preview:first"),n)},e=function(n=null){var e=$(".lesson_parts > .part_content"),s=$(".question_template > fieldset"),u=$(e).find(".fieldQuestion").length,i=s.clone(),f,o;if($(i).find(".fieldset_title").text("Quiz "+(u+1)),$(i).attr("Order",u),$(i).find("[name='Questions.Order']").val(u),n!=null&&(n.ID!=null&&$(i).find("[name='Questions.ID']").val(n.ID),n.Point!=null&&$(i).find("[name='Questions.Point']").val(n.Point),n.Content!=null&&$(i).find("[name='Questions.Content']").val(n.Content),n.Description!=null&&$(i).find("[name='Questions.Description']").val(n.Description),n.Media!=null&&(r(i.find(".media_holder"),"Questions.","",n.Media),t(n,i.find(".media_preview:first"),""))),$(i).find("[name^='Questions.']").each(function(){$(this).attr("name",$(this).attr("name").replace("Questions.","Questions["+u+"]."))}),$(e).append(i),n!=null&&n.Answers!=null)for(f=0;n.Answers!=null&&f<n.Answers.length;f++)o=n.Answers[f],vt(null,i,o);else i.find(".btnAddAnswer").click()},vt=function(n,i=null,u=null){var e=n!=null?$(n).parent().parent():i;var o=$(e).attr("Order"),s=$(e).find(".answer-wrapper"),h=$(".answer_template > .answer-box"),f=h.clone(),c=$(s).find(".answer-box").length;u!=null&&(u.ID!=null&&$(f).find("[name='Questions.Answers.ID']").val(u.ID),u.ParentID!=null&&$(f).find("[name='Questions.Answers.ParentID']").val(u.ParentID),u.Content!=null&&$(f).find("[name='Questions.Answers.Content']").val(u.Content),u.IsCorrect!=null&&($(f).find("[name='Questions.Answers.IsCorrect']").val(u.IsCorrect),$(f).find(".answer-checkbox").prop("checked",u.IsCorrect),u.IsCorrect&&$(f).find(".answer-checkbox").parent().addClass("selected")),u.Media!=null&&(r(f.find(".media_holder"),"Questions.Answers.","",u.Media),t(u,f.find(".media_preview:first"),"")));$(f).find("[name^='Questions.Answers.']").each(function(){$(this).attr("name",$(this).attr("name").replace("Questions.Answers.","Questions["+o+"].Answers["+c+"]."))});n!=null?$(n).before(f):$(i).find(".btnAddAnswer").before(f)},yt=function(){Swal.fire({title:"<strong>Chọn thao tác<\/strong>",icon:"question",html:'<button type="button" class="btn btn-primary mr-2" onclick="ChooseQuestionFile(this)"><i class="fas fa-upload"><\/i> Chọn file câu hỏi <\/button><input type="file" class="d-none" accept=".xlsx, .xls"/><button type="button" class="btn btn-secondary mr-2" onclick="DownloadQuestionTemplate(this)"><i class="fas fa-file-download"><\/i> Tải file mẫu <\/button>',confirmButtonText:"Đóng"})},wi=function(){window.open(n.url.export_quiztemp)},bi=function(n){$(n).siblings("input").unbind().change(function(n){pt(n)});$(n).siblings("input").focus().click()},pt=function(t){Swal.showLoading();var i=new XMLHttpRequest,r=new FormData;r.append("file",t.target.files[0]);i.open("POST",n.url.import_quiz);i.send(r);i.onreadystatechange=function(){var t,n,r,u;if(i.readyState==4&&i.status==200)if(t=JSON.parse(i.responseText),t.Error!=null&&t.Error!="")Swal.hideLoading(),Swal.clickConfirm(),Swal.fire({title:"Thông báo",icon:"error",text:t.Error}).then(()=>{yt()});else{if(n=t.Data,n!=null&&n.Questions!=null)for(r=0;n.Questions!=null&&r<n.Questions.length;r++)u=n.Questions[r],e(u);Swal.hideLoading();Swal.clickConfirm()}}},ki=function(n){if(confirm("Xóa câu hỏi này?")){var i=$(n).siblings("[name$='.ID']").val(),t=$(n).parent();$(n).parent().hasClass("fieldQuestion")||(t=$(n).parent().parent());t.parent().append($("<input>",{type:"hidden",name:"RemovedQuestions",value:i}));t.remove()}},di=function(n){if(confirm("Remove answer?")){var t=$(n).siblings("[name$='.ID']").val();t!==""&&$(n).parent().parent().append($("<input>",{type:"hidden",name:"RemovedAnswers",value:t}));$(n).parent().remove()}},r=function(n,t,i="",r=null){console.log(r);n.empty();n.append($("<input>",{type:"hidden",name:t+"Media.Name","for":"medianame"}));n.append($("<input>",{type:"hidden",name:t+"Media.OriginalName","for":"mediaorgname"}));n.append($("<input>",{type:"hidden",name:t+"Media.Extension","for":"mediaext"}));n.append($("<input>",{type:"hidden",name:t+"Media.Path","for":"mediapath"}));switch(i){case"IMG":n.append($("<input>",{type:"file",name:"file",onchange:"changeMedia(this)","class":"hide",accept:"image/*"}));break;case"VIDEO":n.append($("<input>",{type:"file",name:"file",onchange:"changeMedia(this)","class":"hide",accept:"video/*"}));break;case"AUDIO":n.append($("<input>",{type:"file",name:"file",onchange:"changeMedia(this)","class":"hide",accept:"audio/*"}));break;case"DOC":n.append($("<input>",{type:"file",name:"file",onchange:"changeMedia(this)","class":"hide",accept:".pdf, .doc, .docx, .ppt, .pptx, .xls, .xlsx"}));break;default:n.append($("<input>",{type:"file",name:"file",onchange:"changeMedia(this)","class":"hide"}))}n.append($("<input>",{type:"button","class":"btn btn-primary btnAddFile "+i+" m-1 btn-sm",style:"max-width:80%",onclick:"chooseFile(this)",value:"Chọn file",tabindex:-1}));n.append($("<input>",{type:"button","class":"btn btn-danger btnResetFile btn-sm hide m-1",onclick:"resetMedia(this)",value:"x",tabindex:-1}));r!=null&&(r.Name!=null&&$(n).find("[name='"+t+"Media.Name']").val(r.Name),r.OriginalName!=null&&($(n).find("[name='"+t+"Media.OriginalName']").val(r.OriginalName),$(n).find(".btnAddFile").val(r.OriginalName),$(n).find(".btnResetFile").removeClass("hide")),r.Extension!=null&&$(n).find("[name='"+t+"Media.Extension']").val(r.Extension),r.Path!=null&&$(n).find("[name='"+t+"Media.Path']").val(r.Path))},gi=function(n){var t=$(n).prop("checked");$(n).prev().val(t);$(n).parent().hasClass("selected")!=t&&$(n).parent().toggleClass("selected")},nr=function(){var t=$(".tab-pane"),n=t.index($(".tab-pane.active"));n>0&&nt(n-1)},tr=function(){var n=$(".tab-pane"),t=n.index($(".tab-pane.active"));t<n.length-1&&nt(t+1)},ir=function(n){var f=$("#"+n),i,t,r,u;if(console.log(n),i=f.attr("data-part-id"),t=$(".tab-pane#pills-part-"+i),t.hasClass("active"))return!1;r=$(".tab-pane");u=r.index(t);nt(u)},nt=function(n){stopAllMedia();var t=$(".tab-pane"),i=$(".tab-pane-quiz");$(".tab-pane.show.active").removeClass("show active");$(".tab-pane-quiz.show.active").removeClass("show active");$(t[n]).addClass("show active");$(i[n]).addClass("show active");$(".prevtab").prop("disabled",n==0);$(".nexttab").prop("disabled",n==c-1)},wt=function(n){$(n).toggleClass("btn-warning");$("#QuizNav").hasClass("show")?($("#QuizNav").removeClass("show"),$(".right-content").removeClass("showQuiz")):($("#QuizNav").addClass("show"),$(".right-content").addClass("showQuiz"))},rr=function(){var t=new FormData;t.append("ClassID",n.class_id);t.append("ClassSubjectID",n.class_subject_id);t.append("LessonID",n.lesson_id);$("#"+n.container).find("#ExamID").length==0&&$("#"+n.container).prepend($("<input>",{type:"hidden",name:"ExamID",id:"ExamID"}));gt()||localStorage.clear();o(n.url.current,t,"POST",!0).then(function(n){var t,i,o=0,r;try{r=JSON.parse(n);t=r.exam;i=r.schedule;o=r.limit}catch(l){console.log(l)}if(t==null)localStorage.clear(),console.log("New Fresh Exam"),tt(null,i);else if(s(f("CurrentExam")))localStorage.clear(),console.log("New Exam"),tt(t,i,o);else if(f("CurrentExam")!=t.ID)console.log(f("CurrentExam")),console.log(t.ID),console.log("Unmatched Exam"),localStorage.clear(),h("Timer","00:00"),$("#ExamID").val(t.ID),CompleteExam(!0);else if(t.Status)localStorage.clear(),console.log("New Exam"),tt(t,i,o);else{$("#ExamID").val(t.ID);var a=t.CurrentDoTime,v=t.Created,u=moment(a)-moment(v);if(moment(u).minutes()>=t.Timer)console.log("Exam Timeout"),h("Timer","00:00"),CompleteExam(!0);else{console.log("Exam Continue");h("CurrentExam",t.ID);$("#ExamID").val(t.ID);var e=59-moment(u).second(),c=t.Timer-moment(u).minutes()-(e>0?1:0),u=(c>=10?c:"0"+c)+":"+(e>=10?e:"0"+e);h("Timer",u);kt();b()}}})},tt=function(t,i,r){var e=$(".top-menu[for=lesson-info]"),o=$("<div>",{"class":"p-3 col-md-12 text-center"}),u,y,f;e.length==0&&(e=o);$("#"+n.container).append($(o));var f,h=moment(i.EndDate),a=moment(i.StartDate),v=moment(),c=!1;if(h>moment(new Date(1900,1,1))&&h<=v?(console.log("Over due"),f=$("<div>",{"class":"btn btn-danger m-2",style:"cursor: pointer",disabled:"disabled"}).append('<i class="fas fa-ban mr-2"><\/i>').append("Quá hạn ("+h.format("DD/MM/YYYY hh:mm A")+")"),c=!0):a>=v?(console.log("Early"),f=$("<div>",{"class":"btn btn-danger m-2 lesson-action",style:"cursor: pointer",disabled:"disabled"}).append('<i class="fas fa-ban mr-2"><\/i>').append("Bài chưa được mở ("+a.format("DD/MM/YYYY hh:mm A")+")"),c=!0):(console.log("In due"),f=$("<div>",{"class":"btn btn-primary m-2 lesson-action",onclick:"BeginExam(this)",style:"cursor: pointer"}).append('<i class="fas fa-play mr-2"><\/i>').append("Làm bài")),s(t))e.append(f),lastExamResult=$("<div>",{id:"last-result","class":"text-center"}).append($("<div>",{"class":"text-center h4 btn-primary mt-5 btn",text:"Làm bài ngay",style:"cursor:pointer"}).click(function(){BeginExam(this)}).prepend($("<i>",{"class":"fas fa-play mr-2"}))),o.append(lastExamResult);else{u=t;this.exam_id=u.ID;var l=u.Number,p=!0,b=u.MaxPoint>0?u.Point*100/u.MaxPoint:0,w=moment(u.Updated).format("DD/MM/YYYY hh:mm A");lastExamResult=$("<div>",{id:"last-result","class":"text-center"}).append($("<div>",{"class":"col-md-12 text-center p-3 h5 text-info",text:"Lượt làm cuối (lần "+l+") đã kết thúc lúc "+w})).append($("<div>",{"class":"col-md-12 text-center h4 text-success",text:"Kết quả : "+(u.QuestionsPass==null?0:u.QuestionsPass)+"/"+u.QuestionsTotal})).html();o.append(lastExamResult);tryleft=r-l;y=$("<div>",{"class":"btn btn-primary m-2 lesson-action",onclick:"Review('"+u.ID+"')",style:"cursor: pointer"}).append('<i class="fas fa-poll mr-2"><\/i>').append("Xem đáp án");c||(r>0?(tryleft=r-l,tryleft>0?f=$("<div>",{"class":"btn btn-primary m-2 lesson-action",onclick:"BeginExam(this)",style:"cursor: pointer"}).append('<i class="fas fa-play mr-2"><\/i>').append("Bạn còn <b>"+tryleft+"<\/b> lượt làm lại bài. Thực hiện lại?"):(f=$("<div>",{"class":"btn btn-danger m-2"}).append('<i class="fas fa-ban mr-2"><\/i>').append("Hết lượt làm bài<\/div>"),p=!1)):f=$("<div>",{"class":"btn btn-primary m-2 lesson-action",onclick:"$(this).prop('disabled',true); Redo(this); ",style:"cursor: pointer"}).append('<i class="fas fa-play mr-2"><\/i>').append("Làm lại bài"));e.append(f).append(y)}},it=function(n,t){var r=$("<div>",{"class":"w-100 text-center"}),i,s,f,e,o,u;n!=null?(i=n,this.exam_id=i.ID,s=i.MaxPoint>0?i.Point*100/i.MaxPoint:0,t?($("#rightCol").append($(r)),f=$("<div>",{"class":"btn btn-primary w-50 mt-3",onclick:"CompleteLectureExam('"+i.ID+"')",style:"cursor: pointer"}).append('<i class="fas fa-save mr-2"><\/i>').append("Nộp bài"),r.append(f),$("#rightCol").find(".tab-pane").show(),p()):($("#rightCol").prepend($(r)),e=moment(i.Updated).format("DD/MM/YYYY hh:mm A"),lastExamResult=$("<div>",{id:"last-result","class":"text-center"}).append($("<div>",{"class":"col-md-12 text-center p-3 h5 text-info",text:"Lượt làm bài đã kết thúc lúc "+e})).append($("<div>",{"class":"col-md-12 text-center h4 text-success",text:"Kết quả: "+(i.QuestionsPass==null?0:i.QuestionsPass)+"/"+i.QuestionsTotal})).html(),r.append(lastExamResult),o=$("<div>",{"class":"btn btn-primary m-2 lesson-action",onclick:"Review('"+i.ID+"')",style:"cursor: pointer"}).append('<i class="fas fa-poll mr-2"><\/i>').append("Xem đáp án"),u=$("<div>",{"class":"btn btn-primary m-2 lesson-action",onclick:"$(this).prop('disabled',true); DoLectureExam(this); ",style:"cursor: pointer"}).append('<i class="fas fa-play mr-2"><\/i>').append("Làm lại bài"),r.append(u).append(o),$("#rightCol").find(".tab-pane").hide().removeClass("show"))):($("#rightCol").prepend($(r)),u=$("<div>",{"class":"btn btn-primary m-3",onclick:"$(this).prop('disabled',true); DoLectureExam(this); ",style:"cursor: pointer",text:"Luyện tập"}),r.append(u),$("#rightCol").find(".tab-pane").hide())},ur=function(n){$(n).parent().remove();ft(n);$("#rightCol").find(".tab-pane").hide()},bt=function(t){t!=null&&$(t).prop("disabled",!0);console.log("Create Exam");var i=new FormData;i.append("LessonID",n.lesson_id);i.append("ClassSubjectID",n.class_subject_id);i.append("ClassID",n.class_id);o(n.url.start,i,"POST",!1).then(function(n){var i=JSON.parse(n),r,u;i.Error==null?(console.log("NewID: "+i.Data.ID),$("#ExamID").val(i.Data.ID),h("CurrentExam",i.Data.ID),kt(),i.Data.Timer>0&&(r=i.Data.Timer,u=(r>=10?r:"0"+r)+":00",h("Timer",u))):(notification("error",i.Error,3e3),t!=null&&$(t).prop("disabled",!1))}).catch(function(n){notification("error",n,3e3)})},kt=function(){y(!0);$("#"+n.container).prepend($("<input>",{type:"hidden",name:"ExamID",value:f("CurrentExam"),id:"ExamID"}));v({LessonID:n.lesson_id,ClassSubjectID:n.class_subject_id,ClassID:n.class_id},a)},dt=function(r){var b=$("#"+n.container),d=b.find("#leftCol"),nt=b.find("#rightCol"),k="",tt="",h,p,y,s,e,f,c,l,a,w,u,o,v;r.Timer>0&&(k=" ("+r.Timer+"m)");r.Point>0&&(tt=" ("+r.Point+"p)");h=$(d);(r.Type.toString().startsWith("QUIZ")||r.Type=="ESSAY")&&(h=$(nt));p=$("#part-menu #pills-tab");y=null;$("li #pills-"+r.ID).length>0?y=$("li #pills-"+r.ID).parent().empty():(y=$("<li>",{"class":"nav-item"}),p.append(y));s=$("<a>",{id:"pills-"+r.ID,"class":"nav-link","data-toggle":"pill",href:"#pills-part-"+r.ID,role:"tab","aria-controls":"pills-"+r.ID,"aria-selected":"false",text:r.Title});y.append(s);e=null;e=$("#pills-part-"+r.ID).length>0?$("#pills-part-"+r.ID).empty():$("<div>",{id:"pills-part-"+r.ID,"class":"tab-pane"+(i==UIMode.EXAM_ONLY?" hide":"")+" w-100",role:"tabpanel","aria-labelledby":"pills-"+r.ID});f=$("<div>",{"class":"part-box "+r.Type,id:r.ID});e.append(f);c=$("<div>",{"class":"row "+(i==UIMode.EXAM_ONLY?" Q3_absrow":"")});l=$("<div>",{"class":"part-box-header row"});l.append($("<h5>",{"class":"title col-md-12",text:(r.Title==null?"":r.Title)+k}));f.append(l);a=$("<i>",{"class":"fas fa-caret-down pl-2 pr-2 pt-1 pb-1",style:"cursor:pointer"});$(a).click(function(){toggleExpand(this)});switch(r.Type){case"TEXT":u=$("<div>",{"class":"content-wrapper"});r.Description!=null&&u.append($("<div>",{"class":"doc-content"}).html(r.Description));s.prepend($("<i>",{"class":"far fa-file-word"}));f.append(u);h.append(e);break;case"IMG":l.find(".title").append(a);u=$("<div>",{"class":"media-wrapper collapsable collapse"});r.Description!=null&&u.append($("<div>",{"class":"d-flex justify-content-center"}).append($("<div>",{"class":"part-description"}).html(r.Description)));t(r,u,"IMG");s.prepend($("<i>",{"class":"fas fa-file-image"}));f.append(u);h.append(e);break;case"AUDIO":l.find(".title").append(a);u=$("<div>",{"class":"media-wrapper collapsable collapse"});r.Description!=null&&u.append($("<div>",{"class":"d-flex justify-content-center"}).append($("<div>",{"class":"part-description"}).html(r.Description)));t(r,u,"AUDIO");s.prepend($("<i>",{"class":"fas fa-music"}));f.append(u);h.append(e);break;case"VIDEO":l.find(".title").append(a);u=$("<div>",{"class":"media-wrapper collapsable collapse"});r.Description!=null&&u.append($("<div>",{"class":"d-flex justify-content-center"}).append($("<div>",{"class":"part-description"}).html(r.Description)));t(r,u,"VIDEO");s.prepend($("<i>",{"class":"far fa-play-circle"}));f.append(u);h.append(e);break;case"DOC":l.find(".title").append(a);u=$("<div>",{"class":"media-wrapper collapsable collapse"});r.Description!=null&&u.append($("<div>",{"class":"d-flex justify-content-center"}).append($("<div>",{"class":"part-description"}).html(r.Description)));t(r,u,"DOC");s.prepend($("<i>",{"class":"fas fa-file-word"}));f.append(u);h.append(e);break;case"QUIZ1":case"QUIZ2":for(u=$("<div>",{"class":"quiz-wrapper"}),s.prepend($("<i>",{"class":"fab fa-leanpub"})),f.append(u),t(r,u,""),h.append(e),r.Description!=null&&u.append($("<div>",{"class":"part-description"}).html(r.Description)),totalQuiz=r.Questions.length,o=0;r.Questions!=null&&o<r.Questions.length;o++)v=r.Questions[o],rt(v,r.Type);break;case"QUIZ3":for(f.append(c),u=$("<div>",{"class":"quiz-wrapper col-8"}),s.prepend($("<i>",{"class":"fab fa-leanpub"})),t(r,c,""),c.append(u),r.Description!=null&&c.append($("<div>",{"class":"part-description"}).html(r.Description)),c.find(".media-holder").addClass("col-12"),w=$("<div>",{"class":"answer-wrapper no-child col-4","data-part-id":r.ID}),c.append(w),$(w).droppable({tolerance:"intersect",accept:".answer-item",activeClass:"hasAnswer",hoverClass:"answerHover",drop:function(n,t){var i=t.helper.data("parent");$(i).find(".placeholder").show();$(this).append($(t.draggable))}}),h.append(e),totalQuiz=r.Questions.length,o=0;r.Questions!=null&&o<r.Questions.length;o++)v=r.Questions[o],rt(v,r.Type);break;case"ESSAY":for(u=$("<div>",{"class":"content-wrapper"}),r.Description!=null&&u.append($("<div>",{"class":"part-description"}).html(r.Description)),s.prepend($("<i>",{"class":"fab fa-leanpub"})),f.append(u),h.append(e),u=$("<div>",{"class":"quiz-wrapper"}),f.append(u),t(r,u,""),totalQuiz=r.Questions.length,o=0;r.Questions!=null&&o<r.Questions.length;o++)v=r.Questions[o],rt(v,r.Type)}f.find("iframe,embed,video").each(function(n,t){$(t).wrap($("<div>",{"class":"fullscreenSupport"}));$(t).parent().append($("<div>").append($("<button>",{"class":"btn btn-primary mt-1",click:function(){ShowFullScreen(this)}}).append('<i class="ic fa fa-expand mr-2"><\/i>').append("Xem toàn màn hình")))});p.find(".nav-item").length==1&&(s.addClass("active"),e.addClass("show active"));$(".Q3_absrow .quiz-wrapper").addClass("h-100").addClass("scrollbar-outer").scrollbar();$(".Q3_absrow .answer-wrapper").addClass("h-100").addClass("scrollbar-outer").scrollbar();g()},rt=function(i,r){var v="",y,c,h,f,s;i.Point>0&&(v=" ("+i.Point+"p)");switch(r){case"QUIZ2":var l=$("#"+i.ParentID+" .quiz-wrapper"),e=$("<div>",{"class":"quiz-item",id:i.ID,"data-part-id":i.ParentID}),o=$("<div>",{"class":"quiz-box-header"});for(o.append($("<div>",{"class":"quiz-text",html:u(i.Content)})),t(i,o),e.append(o),l.append(e),h=$("<div>",{"class":"answer-wrapper"}),e.append(h),i.Description!==""&&(y=$("<div>",{"class":"quiz-extend",html:u(i.Description)}),e.append(y)),f=0;i.CloneAnswers!=null&&f<i.CloneAnswers.length;f++)s=i.CloneAnswers[f],ut(s,i.ParentID,r);break;case"QUIZ3":var l=$("#"+i.ParentID+" .quiz-wrapper"),e=$("<div>",{"class":"quiz-item",id:i.ID,"data-part-id":i.ParentID}),p=$("<div>",{"class":"quiz-pane col-6"}),w=$("<div>",{"class":"answer-pane no-child col-6","data-question-id":i.ID,"data-part-id":i.ParentID,"data-lesson-id":n.lesson_id,"data-type":r});for(e.append(p),e.append(w),c=$("<div>",{"class":"pane-item"}),i.Media==null?c.append($("<div>",{"class":"quiz-text",html:u(i.Content)})):t(i,c),p.append(c),l.append(e),$(w).droppable({tolerance:"intersect",accept:".answer-item",activeClass:"hasAnswer",hoverClass:"answerHover",drop:function(n,t){$(this).find(".placeholder").hide();var i=t.helper.data("parent");$(this).find(".answer-item").length>0?$(i).append($(this).find(".answer-item")):$(i).find(".placeholder").show();$(this).append($(t.draggable))}}),f=0;i.CloneAnswers!=null&&f<i.CloneAnswers.length;f++)s=i.CloneAnswers[f],ut(s,i.ParentID,r);break;default:var l=$("#"+i.ParentID+" .quiz-wrapper"),a=$("<div>",{"class":"quiz-item",id:i.ID,"data-part-id":i.ParentID}),o=$("<div>",{"class":"quiz-box-header"});for(i.Content!=null?o.append($("<h5>",{"class":"title",html:u(i.Content)})):o.append($("<h5>",{"class":"title",text:v})),t(i,o),a.append(o),h=$("<div>",{"class":"answer-wrapper"}),a.append(h),l.append(a),f=0;i.CloneAnswers!=null&&f<i.CloneAnswers.length;f++)s=i.CloneAnswers[f],ut(s,i.ParentID,r)}},ut=function(i,r,f){var o=$("#"+i.ParentID+" .answer-wrapper"),e=$("<fieldset>",{"class":"answer-item",id:i.ID}),h,c,s;switch(f){case"QUIZ2":$(o).find(".answer-item").length==0&&(e.append($("<input>",{type:"text","class":"input-text answer-text form-control",onfocusout:"AnswerQuestion(this)",id:"inputQZ2-"+i.ParentID,"data-part-id":r,"data-lesson-id":n.lesson_id,"data-question-id":i.ParentID,"data-type":f}).attr("autocomplte","off")),o.append(e));break;case"QUIZ3":h=$("#"+i.ParentID).find(".answer-pane");$(h).removeClass("no-child");h.empty().append($("<div>",{"class":"pane-item placeholder",text:"Drop your answer here"}));o=$("#"+i.ParentID).parent().siblings(".answer-wrapper");i.Content!=null&&e.append($("<input>",{type:"hidden",value:i.Content}));i.Media!=null?t(i,e):e.append($("<label>",{"class":"answer-text",html:u(i.Content)}));c=Math.floor(Math.random()*2);c>0?o.append(e):o.prepend(e);break;default:s=$("<div>",{"class":"form-check"});e.append(s);s.append($("<input>",{type:"hidden"}));s.append($("<input>",{id:i.ID,type:"radio","class":"input-checkbox answer-checkbox form-check-input",onclick:"AnswerQuestion(this)","data-part-id":r,"data-lesson-id":n.lesson_id,"data-question-id":i.ParentID,"data-id":i.ID,"data-type":f,"data-value":i.Content,name:"rd_"+i.ParentID}));i.Content!=null&&s.append($("<label>",{"class":"answer-text form-check-label","for":i.ID,html:u(i.Content)}));t(i,e);o.append(e)}},fr=function(t){var r=$(".top-menu[for=lesson-info]"),i;r.empty();$("#QuizNav").hasClass("show")&&wt();(t||!0)&&(i=new FormData,i.append("ExamID",$("#ExamID").val()),o(n.url.end,i,"POST",!0).then(function(n){ht();var t=JSON.parse(n);localStorage.clear();or(t)}).catch(function(n){console.log(n)}))},er=function(){var t=new FormData;console.log("Complete :"+$("#ExamID").val());t.append("ExamID",$("#ExamID").val());o(n.url.end,t,"POST",!0).then(function(n){ht();var t=JSON.parse(n);localStorage.clear();document.location.href=window.location.href.substr(0,window.location.href.indexOf("#"))}).catch(function(n){console.log(n)})},or=function(t){var u=$(".top-menu[for=lesson-info]"),o=$("<div>",{"class":"p-3 col-md-12 text-center"}),h,r;if($("#"+n.container).empty().append($(o)),s(t))r=$("<div>",{"class":"btn btn-primary m-2",onclick:"$(this).prop('disabled',true); BeginExam(this);",style:"cursor: pointer",text:"Làm bài"}),u.append(r);else{var i=t,c=i.maxPoint>0?i.point*100/i.maxPoint:0,f=i.limit,e=i.number;console.log(i);lastExamResult=$("<div>",{id:"last-result","class":"text-center"}).append($("<div>",{"class":"col-md-12 text-center p-3 h5 text-info",text:"Chúc mừng! Bạn đã hoàn thành bài kiểm tra (lần "+e+")"})).append($("<div>",{"class":"col-md-12 text-center h4 text-success",text:"Kết quả: "+(i.questionsPass==null?0:i.questionsPass)+"/"+i.questionsTotal}));o.append(lastExamResult);tryleft=f-e;h=$("<div>",{"class":"btn btn-primary m-2",onclick:"Review('"+i.id+"'); $(this).prop('disabled',true)",style:"cursor: pointer"}).append('<i class="fas fa-poll mr-2"><\/i>').append("Xem đáp án");f>0?(tryleft=f-e,tryleft>0?r=$("<div>",{"class":"btn btn-primary m-2",onclick:"$(this).prop('disabled',true); BeginExam(this);",style:"cursor: pointer"}).append('<i class="fas fa-play mr-2"><\/i>').append("Bạn còn <b>"+tryleft+"<\/b> lượt làm lại bài. Thực hiện lại?"):(r=$("<div>",{"class":"btn btn-danger m-2"}).append('<i class="fas fa-ban mr-2"><\/i>').append("Hết lượt làm bài"),doable=!1)):r=$("<div>",{"class":"btn btn-primary m-2",onclick:"$(this).prop('disabled',true); Redo(this);",style:"cursor: pointer"}).append('<i class="fas fa-play mr-2"><\/i>').append("Làm lại bài");console.log(r);$(u).append(r).append(h);console.log(u)}},sr=function(){v({LessonID:n.lesson_id,ClassID:n.class_id,ExamID:n.exam_id},a)},hr=function(){v({LessonID:n.lesson_id,ClassSubjectID:n.class_subject_id,ClassID:n.class_id},a)},cr=function(){document.location="/student/Course/Modules/"+n.class_id},ft=function(n){var t=$(".top-menu[for=lesson-info]");t.empty();console.log("Redo Exam");localStorage.clear();bt(n)},lr=function(t){document.location=n.url.review+"/"+t},gt=function(){return!s(f("CurrentExam"))},ar=function(){return"1.0.0"},vr=function(t){if(t==null||typeof t=="undefined")return n;for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},o=function(n,t,i,r){var u=new XMLHttpRequest;return new Promise(function(f,e){u.onreadystatechange=function(){if(u.readyState==4)if(u.status>=200&&u.status<300)f(u.response);else{var n=u.statusText==""?"Có lỗi xảy ra ("+["UNSENT\tClient has been created.open() not called yet.","OPENED\topen() has been called.","HEADERS_RECEIVED\tsend() has been called, and headers and status are available.","LOADING\tDownloading; responseText holds partial data.","DONE\tThe operation is complete."][u.status]+")":u.statusText;notification("error",n,5e3);e({status:u.status,statusText:u.statusText})}else return null};u.open(i||"POST",n,r||!0);u.send(t)})},ni=function(t){var i=t.dataset,l=i.type,f="",e="",h="",u="",s,c,r;switch(l){case"QUIZ1":f=i.partId;e=i.questionId;h=i.id;u=i.value;break;case"QUIZ2":f=i.partId;e=i.questionId;u=t.value;break;case"QUIZ3":f=i.partId;e=i.questionId;s=t.querySelector("fieldset");c=s.querySelector("label");c=c==null?s.querySelector("[src]").src:s.querySelector("label").innerHTML;u=s==void 0?"":c;h=s.id;break;case"ESSAY":f=i.partId;u=t.value;h=t.id}r=new FormData;r.append("ExamID",$("input[name=ExamID]").val());l!="ESSAY"?(r.append("LessonPartID",f),r.append("AnswerID",h),r.append("QuestionID",e),r.append("AnswerValue",u)):(r.append("LessonPartID",f),r.append("AnswerValue",u));o(n.url.answer,r,"POST",!1).then(function(){}).catch(function(n){notification("error",n,3e3)});u==""?ti(e):pr(e,h,u,l)},ti=function(t){st(t);var i=new FormData;i.append("ExamID",$("#ExamID").val());i.append("QuestionID",t);o(n.url.removeans,i,"POST",!1).then(function(){p();var n=document.getElementById("quizNav"+t);n!=null&&n.classList.remove("completed")}).catch(function(n){notification("error",n,3e3)})},yr=function(t){st(t);var i=new FormData;i.append("ExamID",$("#ExamID").val());i.append("QuestionID",t);o(n.url.removeans,i,"POST",!1).then(function(){var n=document.getElementById("quizNav"+t);n!=null&&n.classList.remove("completed")}).catch(function(n){notification("error",n,3e3)})},pr=function(n,t,i,r){var f,u;n!=void 0&&(f=n+"~~"+t+"~~"+i+"~~"+r,h(n,f),p(),u=document.getElementById("quizNav"+n),u!=null&&u.classList.add("completed"))},p=function(){for(var s,t,i,n=document.querySelectorAll(".quiz-item"),r=0,h="",u=0;n!=null&&u<n.length;u++){var e=n[u],o=f(e.id),c="";o!=null&&o!=void 0&&o!=""&&(r++,c="completed",wr(o));h+='<button class="btn bg-secondary text-white rounded-quiz '+c+'" type="button" id="quizNav'+e.id+'" name="quizNav'+e.id+'" onclick="window.GoQuiz(\''+e.id+"')\">"+(u+1)+"<\/button>"}s=$("#quiz_number_counter");s.length>0?(s.find(".completed").text(r),s.find(".total").text(n.length)):$(".top-menu[for=lesson-info] .prevtab").after($("<button>",{id:"quiz_number_counter","class":"quizNumber btn btn-primary mt-2 mr-2 mb-2",onclick:"ToggleNav(this)",tooltips:"Toggle Scoreboard"}).append($("<i>",{"class":"fas fa-question-circle mr-2"})).append("Câu đã trả lời ").append($("<span>",{"class":"completed ml-1",text:r})).append(" / ").append($("<span>",{"class":"total",text:n.length})));t=$("#quizNavigator");t.length==0&&(t=$("<div>",{id:"quizNavigator","class":"p-1"}),t.append($("<div>",{"class":"input-group quiz-wrapper"}).append(h)),$("#quizIdx_holder").append(t));$("#QuizNav").append(t);n!=null&&r>=n.length?(i=document.getElementById("btn-completed"),i!=null&&(i.style.display="block")):(i=document.getElementById("btn-completed"),i!=null&&(i.style.display="none!important"));g()},wr=function(n){var i=n.split("~~"),r=i[0],f=i[1],e=i[2],o=i[3],u,t;switch(o){case"QUIZ1":u=$("#"+f);$(u).find("input[type='radio']").attr("checked","");break;case"QUIZ2":t=$("#inputQZ2-"+r);$(t).val(e);break;case"QUIZ3":var t=document.getElementById(r),s=t.querySelector('[data-question-id="'+r+'"]'),u=document.getElementById(f),h=u.outerHTML;u.remove();s.innerHTML=h;break;case"ESSAY":t=document.getElementById("essay-"+r);t.innerHTML=e;break;default:return}};return window.LessonInstance={}||Lesson,LessonInstance.onReady=et,LessonInstance.Version=ar,LessonInstance.Notification=notification,window.BeginExam=bt,window.AnswerQuestion=ni,window.CompleteExam=fr,window.CompleteLectureExam=er,window.Redo=ft,window.DoLectureExam=ur,window.GoBack=cr,window.GoQuiz=ir,window.EditLesson=si,window.EditPart=hi,window.AddPart=ci,window.SelectTemplate=oi,window.RemovePart=ai,window.SortPart=yi,window.RemoveQuestion=ki,window.AddNewQuestion=e,window.ShowCloneQuestion=yt,window.ChooseQuestionFile=bi,window.UploadQuestionFile=pt,window.DownloadQuestionTemplate=wi,window.RemoveAnswer=di,window.AddNewAnswer=vt,window.ToggleCorrectAnswer=gi,window.ToggleExplanation=ei,window.ToggleNav=wt,window.ReloadData=ot,window.Review=lr,window.NextPart=tr,window.PrevPart=nr,window.SwitchMode=ii,LessonInstance}(),hideModal=function(n){n!=null?$(n).modal("hide"):$(".modal").modal("hide")},submitForm=function(n,t,i){var e,h,r,o;n.preventDefault();$(".btnSaveForm").hide();var u=$(t).find("form"),s=u.length>0?u[0]:window.partForm,f=new FormData(s);if($('textarea[name="Description"]').length>0&&(f.delete("Description"),f.append("Description",CKEDITOR.instances.editor.getData())),e=!1,h=$(s).find(":required"),document.activeElement.blur(),h.each(function(){var n=$(this);if($(this).val()==""||$(this).val()==null)return Swal.fire({title:"Lưu ý",text:"Vui lòng điền đầy đủ nội dung",icon:"warning",confirmButtonText:"Đóng"}).then(()=>{$(".btnSaveForm").show(),$(n).focus()}),e=!0,!1}),e)return!1;r=new XMLHttpRequest;o=$("#action").val();u.length>0&&(o=u.attr("action"));$(".btnSaveForm").after($("<div>",{"class":"pending",text:"Đang gửi dữ liệu, vui lòng đợi..."}));r.open("POST",o);r.send(f);r.onreadystatechange=function(){var n,u;r.readyState==4&&r.status==200&&(n=JSON.parse(r.responseText),n.Error==null||n.Error==""?(i=="addPart"?(u=n.Data,window.AddPart(u)):i==null?window.ReloadData():i,hideModal(t)):alert(n.Error));$(".btnSaveForm").siblings(".pending").remove();$(".btnSaveForm").show()}},toggleExpand=function(n){$(".collapsable").addClass("collapse");$(".media-holder video").trigger("pause");$(n).hasClass("fa-caret-up")?$(n).removeClass("fa-caret-up"):($(".title > .fa-caret-up").removeClass("fa-caret-up"),$(n).addClass("fa-caret-up"),$(n).parent().parent().siblings(".collapse").removeClass("collapse"),$("#leftCol").animate({scrollTop:$(n).parent().parent().parent().parent().offset().top-60},500))};
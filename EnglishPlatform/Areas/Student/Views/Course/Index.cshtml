@{

    Layout = "~/Views/Shared/_LayoutStudent_NewUI.cshtml";
    var model = ViewBag.Model as BaseCustomerMVC.Models.DefaultModel;
    ViewData["Title"] = "My Courses";
}

<script>
    setActiveMenu("course");
    activeSub = "home";
</script>

<section class="module" id="dashboard_content">
    <div class="card-header">
        <div class="flex border-b padding-b25">
            <h2 class="title">@ViewData["Title"]</h2>
        </div>
    </div>
    <div class="main-container pl-3 pr-3">
        <div class="active-region">
            <div class="block-title pt-2 pb-2">
                <h2>Ongoing</h2>
            </div>
            <table id="activeCourse" class="table" width="100%" cellspacing="0">
                <thead>
                    <tr class="text-center">
                        <th class="text-center">Index</th>
                        <th class="text-left">Subject</th>
                        <th class="text-left">Course</th>
                        <th class="text-center">Period</th>
                        <th class="text-center">Progress</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="past-region" style="display: none">
            <div class="block-title">
                <h2>Past Enrollments</h2>
            </div>
            <table id="pastCourse" class="table" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th class="text-center">Index</th>
                        <th class="text-left">Subject</th>
                        <th class="text-left">Course</th>
                        <th class="text-center">Period</th>
                        <th class="text-center">Result</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</section>

@section Scripts{
    <script>

        function LoadData() {
        $.ajax({
            type: "POST",
            url: '@Url.Action("GetList", "Course")',
            data: {},
            dataType:"json",
            success: function (data) {
                var body = $('#activeCourse tbody');
                var pastBody = $('#pastCourse tbody');
                body.html("");
                if (data.Data.length > 0)
                {
                    var counter = 0;
                    var pastcounter = 0;
                    for (i = 0; i < data.Data.length; ++i) {
                        item = data.Data[i];

                        var startdate = moment(item.StartDate).format('DD/MM/YYYY');
                        var enddate = moment(item.EndDate).format('DD/MM/YYYY');

                        var totalLesson = 1;
                        var completeLesson = 0;
                        if (item.Progress != null) {
                            completeLesson = item.Progress.CompletedLessons.length;
                            totalLesson = item.Progress.TotalLessons;
                        }

                        var today = new Date();
                        var past = moment(today).diff(moment(item.EndDate), 'days') > 0;
                        var count = past ? ++pastcounter : ++counter;

                        var row ="<tr>" +
                            "<td class='text-center'>"+ count +"</td>"+
                            "<td><a href='"+'@Url.Action("Detail", "Course")' + "/" + item.ID + "' >" + item.SubjectName + "</a></td>" +
                            "<td><a href='"+'@Url.Action("Detail", "Course")' + "/" + item.ID + "' >" + item.Name + "</a></td>" +
                            //"<td>" + item.TeacherName + "</td>" +
                            "<td class='text-center'>" + startdate + " - " + enddate + "</td>" +
                             "<td class='text-center'>" + Math.ceil(completeLesson * 100 / totalLesson) + "%</td>"+
                        "</tr>";
                        if (past) {
                            $('.past-region').show();
                             pastBody.append(row);
                        }
                        else {
                            body.append(row);
                        }
                    }
                }
            },
            error: function (err) {
                console.log(err.responseText)
            }
        });
    };

    LoadData();

    </script>
}
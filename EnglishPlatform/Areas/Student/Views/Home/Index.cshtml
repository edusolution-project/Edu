
@{
    ViewData["Title"] = "Dashboard - " + DateTime.Now.ToString("D");
    Layout = "~/Views/Shared/_LayoutStudent_NewUI.cshtml";
    var student = ViewBag.Student as BaseCustomerEntity.Database.StudentEntity;
}
@*<link href="~/css/calendar/core.css" rel="stylesheet" />
    <link href="~/css/calendar/daygrid.css" rel="stylesheet" />
    <link href="~/css/calendar/list.css" rel="stylesheet" />
    <link href="~/css/calendar/timegrid.css" rel="stylesheet" />*@
@*<script>
        activeTab = "dashboard";
    </script>*@

<section class="module" id="dashboard_content">
    <div class="card-header">
        <div class="flex border-b padding-b25">
            <h2 class="title">Welcome to <font>EDUCOO</font></h2>
            <div class="search-box">
                <button><i class="ic ic-find"></i></button>
                <input type="text" name="" placeholder="Search">
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="row margin-b20">
            <div class="col-md-6">
                <div class="box radius padding-20">
                    <div class="heading flex">
                        <h4 class="box-head">Bài học tuần này</h4>
                        <a href="#" title="Xem tất cả" class="link-all">Xem tất cả <i class="ti-arrow-right"></i></a>
                    </div>
                    <ul class="list-lesson">
                        <li v-for="(item,k) in lesson_week">
                            <div class="c-left">
                                <p><span class="title">{{item.title}}</span> - <span>{{item.lesson}}</span></p>
                                <div class="d-time"><i class="ti-time"></i>{{item.date}}</div>
                            </div>
                            <div class="c-right" v-bind:class="{bad : parseInt(item.per)<50}">
                                <div class="flex">
                                    <b-progress :value="item.score" :max="item.total_scrore" class="mb-3"></b-progress>
                                    <span>{{item.per}}%</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <script>

            </script>

            <div class="col-md-6">
                <div class="box radius margin-b20 padding-20">
                    <div class="heading flex">
                        <h4 class="box-head">Khoá học đang diễn ra</h4>
                        <a href="#" title="Xem tất cả" class="link-all">Xem tất cả <i class="ti-arrow-right"></i></a>
                    </div>
                    <ul class="list-lesson" v-if="active_course.length">
                        <li v-for="(item,k) in active_course">
                            <div class="c-left">
                                <p><a :href="'@Url.Action("Detail", "Course")/' + item.id"><span class="title">{{item.subjectName}}</span> - <span>{{item.courseName}}</span></a></p>
                                <div class="d-time"><i class="ti-time"></i>{{item.endDate}}</div>
                            </div>
                            <div class="c-right" v-bind:class="{bad : parseInt(item.per)<50}">
                                <div class="flex">
                                    <b-progress :value="item.percent" :max="100" class="mb-3"></b-progress>
                                    <span>{{item.percent}}%</span>
                                </div>
                                <span>{{item.score}} điểm</span>
                            </div>
                        </li>
                    </ul>
                    <p v-else cla>No active course</p>
                </div>
                <div class="box radius padding-20">
                    <div class="heading flex">
                        <h4 class="box-head">Thảo luận</h4>
                        <a href="#" title="Xem tất cả" class="link-all">Xem tất cả <i class="ti-arrow-right"></i></a>
                    </div>
                    <ul class="list-discus">
                        <li v-for="(item,k) in discussion">
                            <div class="flex c-top">
                                <a href="#" :title="item.title" class="title">{{item.title}}</a>
                                <div class="c-right"><i class="icofont icofont-user"></i>{{item.member + ' members'}}</div>
                            </div>
                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="module">
            <div class="col-md-12 margin-b20">
                <div class="heading flex">
                    <h4 class="box-head">Khóa học đã kết thúc</h4>
                    <a href="#" title="Xem tất cả" class="link-all">Xem tất cả <i class="ti-arrow-right"></i></a>
                </div>
            </div>
            <ul class="row">
                <li class="col-md-4 less-done list" v-for="(item,k) in finish_course">
                    <div class="box radius">
                        <a href="#" class="flex">
                            <span class="per">{{item.per + '%'}}</span>
                            <div class="info">
                                <span>{{item.title}}</span>
                                <span>{{item.score}} điểm</span>
                            </div>
                            <span class="arr-right ti-arrow-right"></span>
                        </a>
                    </div>
                </li>
            </ul>
        </div>

    </div>
</section>

<script>
    new Vue({
        el: "#main",
        mounted() {
            this.getActiveCourse()
            this.getFinishCourse()
        },
        data: {
            lesson_week: [
                {
                    lesson: 'Lesson 1',
                    title: 'IELTS Practice',
                    date: '12/08/2019 ',
                    score: 2,
                    total_scrore: 5,
                    per: '70'
                },
                {
                    lesson: 'Lesson 2',
                    title: 'IELTS Practice',
                    date: '12/08/2019 ',
                    score: 3,
                    total_scrore: 5,
                    per: '40'
                },
                {
                    lesson: 'Thì hiện tại tiếp diễn',
                    title: 'Ngữ pháp A2',
                    date: '12/08/2019 ',
                    score: 4.5,
                    total_scrore: 5,
                    per: '45'
                }
            ],
            active_course: [
            ],
            discussion: [
                {
                    title: 'IELTS 5.0',
                    member: 3,
                    description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et.'
                },
                {
                    title: 'IELTS 5.1',
                    member: 12,
                    description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et.'
                }
            ],
            finish_course: [
            ],
            list_news: [
                {
                    title: 'Đã đến lúc HLV Park',
                    description: 'Đây là lúc để HLV Park giải bài toán khó nhất của ông',
                    thumbnail: '/pictures/news1.png'
                },
                {
                    title: 'HLV Park: Có khi p',
                    description: 'Đây là lúc để HLV Park giải bài toán khó nhất của ông',
                    thumbnail: '/pictures/news2.png'
                },
                {
                    title: 'Tiến Dũng và Văn Toả',
                    description: 'Đây là lúc để HLV Park giải bài toán khó nhất của ông',
                    thumbnail: '/pictures/news3.png'
                }
            ]
        },
        watch: {
            lesson_week: function (val) {
                console.log(val)
            }
        },
        methods: {
            getActiveCourse() {
                let _that = this
                // Truyen param vào đây
                let _form = new FormData()
                _form.append('StartDate', '@DateTime.Now.ToString("MM/dd/yyyy")');
                let _url = '@Url.Action("GetActiveList", "Course")'

                axios.post(_url, _form)
                    .then(response => {
                        console.log(response.data)
                        _that.active_course = response.data.data;
                        console.log(_that.active_course);
                    }).catch(e => { })
            },
            getFinishCourse() {
                let _that = this
                // Truyen param vào đây
                let _form = new FormData()
                _form.append('StartDate', '@DateTime.Now.ToString("MM/dd/yyyy")');
                let _url = '@Url.Action("GetFinishList", "Course")'

                axios.post(_url, _form)
                    .then(response => {
                        console.log(response.data)
                        _that.finish_course = response.data.data;
                        console.log(_that.active_course);
                    }).catch(e => { })
            }
        }
    });
</script>


@*<div id="calendarModalView" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"></h4>

                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span> <span class="sr-only">close</span></button>
                </div>
                <div id="modalBody" class="modal-body">
                    <div class="form-group form-inline">
                        <label for="start-date"> Start : </label>
                        <b name="start-date"></b>
                    </div>
                    <div class="form-group form-inline">
                        <label for="end-date"> End : </label>
                        <b name="end-date"></b>
                    </div>
                    <div class="form-group">
                        <label for="end-date">Link : </label>
                        <a href="#" name="link"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>*@

@*<style>
        .active-region, past-region{
            margin-top:20px;
        }

        .fc-content {
            font-size: 9px;
            cursor: pointer;
        }

        .fc-center {
            font-size: 7px;
        }

        /*.fc-toolbar.fc-header-toolbar {
            margin-bottom: .5em;
        }*/

        .fc-toolbar .fc-button {
            /*padding: 0.2em;*/
            /*line-height: 1em;*/
        }

        .fc-dayGrid-view .fc-body .fc-row {
            min-height: 3em;
        }

        .fc-day-header {
            font-weight: normal;
            border: solid 1px #CCC !important;
            /*font-size: 11px;*/
        }

            .fc-day-header span {
                font-size: 11px;
            }

        .fc-day-top {
            text-align: right;
            padding-right: 3px !important;
        }

        .fc-button .fc-icon {
            font-size: 1em;
        }

        .fc-icon {
            height: 1em;
        }
    </style>*@
@*<script src="~/js/lib/schedule-mini.js"></script>
    <script>
        var schedulex = new CalendarLib.Schedule($);
            schedulex.onLoad({
                type: "@User?.FindFirst("Type").Value",
                controller: 'Calendar'
            });

        function LoadData() {
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetList", "Course")',
                data: { },
                dataType:"json",
                success: function (data) {
                    var activeCourse = $('#activeCourse tbody');
                    var pastCourse = $('#pastCourse tbody');
                    activeCourse.html("");
                    pastCourse.html("");
                    if (data.Data.length > 0)
                    {
                        var counter = 0;
                        var pastcounter = 0;
                        for (i = 0; i < data.Data.length; ++i) {
                            item = data.Data[i];
                            //var active = "<td><button type='button' data-toggle='button' aria-pressed='true' autocomplete='off' class='btn btn-lg btn-toggle active btn-success' disabled> <div class='handle'></div> </button></td>";

                            var startdate = moment(item.StartDate).format('DD/MM/YYYY');
                            var enddate = moment(item.EndDate).format('DD/MM/YYYY');
                            var today = new Date();

                            //var totalday = moment(item.EndDate).diff(moment(item.StartDate), 'days');
                            //var completeday = moment(today).diff(moment(item.StartDate), 'days');
                            //if(completeday > totalday) completeday = totalday;

                            var past = moment(today).diff(moment(item.EndDate), 'days') > 0;

                            var count = past ? ++pastcounter : ++counter;

                            var totalLesson = 1;
                            var completeLesson = 0;
                            if (item.Progress != null) {
                                completeLesson = item.Progress.CompletedLessons.length;
                                totalLesson = item.Progress.TotalLessons;
                            }

                            var row =
                                "<tr>" +
                                    "<td class='text-center'>" + count + "</td>" +
                                    "<td><a href='"+'@Url.Action("Detail", "Course")' + "/" + item.ID + "' >" + item.SubjectName + "</a></td>" +
                                    "<td><a href='"+'@Url.Action("Detail", "Course")' + "/" + item.ID + "' >" + item.Name + "</a></td>" +
                                    //"<td>" + item.GradeName + "</td>" +
                                    "<td class='text-center'>" + startdate + " - " + enddate + "</td>" +
                                    //"<td class='text-center'>Đã hoàn thành</td>" +
                                    "<td class='text-center'>" + Math.ceil(completeLesson * 100 / totalLesson) + "%</td>"+
                                "</tr>";
                            if (past) {
                                $('.past-region').show();
                                 pastCourse.append(row);
                            }
                            else {
                                $('#activeCourse').show();
                                activeCourse.append(row);
                            }
                        }
                        if (counter === 0) {
                            $('#placeholderActive').empty().append($("<div>", { class: "w-100 text-left pt-0 mb-3", text: "Không có khóa học nào" }));
                        }
                        else
                            $('#placeholderActive').hide();

                        if (pastcounter === 0) {
                            $('#placeholderPast').empty().append($("<div>", { class: "w-100 text-left pt-0 mb-3", style:"font-size:1rem;", text: "Không có khóa học nào" }));
                        }
                        else
                            $('#placeholderPast').hide();
                    }
                },
                error: function() {
                    alert("Error");
                }
            });
        };

        $(document).ready(function(){
            //LoadMyClass();
            //LoadTodayLesson();
            LoadData();
        });
    </script>*@

